import{j as e}from"./vendor-ui-CHMJddlm.js";import{r as c}from"./vendor-react-B7WRoy5K.js";import{u as z,a as p,l as N,h as P,B as R,aN as B,t as G,v as M,T as w,r as C}from"./index-Ck6H6S7e.js";import{F as n}from"./FormField-CDjC7Prj.js";import{C as X}from"./ConfirmDialog-CqHyERYG.js";import"./vendor-charts-C5vizwv2.js";const Y=()=>{const{t,i18n:k}=z(),[S,F]=c.useState([]),[q,D]=c.useState(!0),[m,f]=c.useState(!1),[u,g]=c.useState({type:"",text:""}),[L,x]=c.useState(!1),[a,d]=c.useState(null),[h,y]=c.useState(null),[s,o]=c.useState({field_name:"",field_type:"text",field_label_pt:"",field_label_en:"",field_label_fr:"",field_label_de:"",field_category:"other",field_options:"",is_required_default:!1});c.useEffect(()=>{_()},[]);const _=async()=>{try{const l=await p.get("/settings/field-catalog");console.log("Field catalog data:",l),F(l.fields||[])}catch(l){console.error("Field catalog error:",l),g({type:"error",text:l.message||"Erro ao carregar catálogo"})}finally{D(!1)}},E=async()=>{f(!0);try{const l={...s,field_options:s.field_options?s.field_options.split(",").map(i=>i.trim()):void 0};await p.post("/settings/field-catalog",l),x(!1),o({field_name:"",field_type:"text",field_label_pt:"",field_label_en:"",field_label_fr:"",field_label_de:"",field_category:"other",field_options:"",is_required_default:!1}),_(),g({type:"success",text:t("settings.fieldAdded")})}catch(l){g({type:"error",text:l.message})}finally{f(!1)}},T=async()=>{if(a){f(!0);try{const l={field_label_pt:a.field_label_pt,field_label_en:a.field_label_en,field_label_fr:a.field_label_fr,field_label_de:a.field_label_de,field_type:a.field_type,field_category:a.field_category,field_order:a.field_order,is_required_default:a.is_required_default,field_options:a.field_options};await p.put(`/settings/field-catalog/${a.field_name}`,l),d(null),_(),g({type:"success",text:t("settings.saved")})}catch(l){g({type:"error",text:l.message})}finally{f(!1)}}},I=async l=>{try{await p.delete(`/settings/field-catalog/${l}`),y(null),_(),g({type:"success",text:t("settings.fieldDeleted")})}catch(i){g({type:"error",text:i.message})}},j={identification:t("settings.categories.identification"),specifications:t("settings.categories.specifications"),installation:t("settings.categories.installation"),warranty:t("settings.categories.warranty"),maintenance:t("settings.categories.maintenance"),equipment:t("settings.categories.equipment"),electrical:t("settings.categories.electrical")||"Elétrico",other:t("settings.categories.other")},v={text:"Texto",number:"Número",date:"Data",select:"Seleção",textarea:"Texto Longo"},b={};S.forEach(l=>{const i=l.field_category||"other";b[i]||(b[i]=[]),b[i].push(l)});const O=["identification","specifications","installation","electrical","warranty","maintenance","equipment","other"],A=l=>{const r=`field_label_${k.language}`;return l[r]||l.field_label_pt};return q?e.jsx("div",{className:"flex justify-center p-8",children:e.jsx(N,{size:32,className:"animate-spin"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:t("settings.fieldCatalogDescription")||"Gerir campos disponíveis para todos os tenants"}),e.jsxs("button",{onClick:()=>x(!0),className:"inline-flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),t("settings.newField")]})]}),u.text&&e.jsx("div",{className:`p-4 rounded-lg ${u.type==="error"?"bg-red-50 text-red-700 dark:bg-red-900/20 dark:text-red-400":"bg-green-50 text-green-700 dark:bg-green-900/20 dark:text-green-400"}`,children:u.text}),O.map(l=>{const i=b[l];return!i||i.length===0?null:e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3 uppercase tracking-wide",children:j[l]||l}),e.jsx("div",{className:"space-y-2",children:i.sort((r,$)=>r.field_order-$.field_order).map(r=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[r.is_system?e.jsx(R,{className:"h-5 w-5 text-blue-500",title:t("settings.systemField")}):e.jsx(B,{className:"h-5 w-5 text-gray-400",title:t("settings.customField")}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:[A(r),r.is_required_default===1&&e.jsx("span",{className:"ml-2 text-xs text-red-500",children:"*"})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[e.jsx("code",{className:"bg-gray-100 dark:bg-gray-700 px-1 rounded",children:r.field_name})," · ",v[r.field_type]||r.field_type,r.is_system===1&&e.jsx("span",{className:"ml-2 px-1.5 py-0.5 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 rounded text-xs",children:t("settings.systemField")})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>d(r),className:"p-2 text-gray-400 hover:text-blue-500",title:t("common.edit"),children:e.jsx(G,{className:"h-4 w-4"})}),!r.is_system&&e.jsx("button",{onClick:()=>y(r.field_name),className:"p-2 text-gray-400 hover:text-red-500",title:t("common.delete"),children:e.jsx(M,{className:"h-4 w-4"})})]})]},r.id))})]},l)}),L&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:t("settings.newField")}),e.jsx("button",{onClick:()=>x(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(w,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(n,{label:t("settings.fieldName")+" (ID)",name:"field_name",value:s.field_name,onChange:l=>o({...s,field_name:String(l).toLowerCase().replace(/\s+/g,"_")}),required:!0,helpText:"ex: contract_number"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(n,{label:"Label PT",name:"field_label_pt",value:s.field_label_pt,onChange:l=>o({...s,field_label_pt:String(l)}),required:!0}),e.jsx(n,{label:"Label EN",name:"field_label_en",value:s.field_label_en,onChange:l=>o({...s,field_label_en:String(l)})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(n,{label:"Label FR",name:"field_label_fr",value:s.field_label_fr,onChange:l=>o({...s,field_label_fr:String(l)})}),e.jsx(n,{label:"Label DE",name:"field_label_de",value:s.field_label_de,onChange:l=>o({...s,field_label_de:String(l)})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(n,{label:t("common.type"),name:"field_type",type:"select",value:s.field_type,onChange:l=>o({...s,field_type:String(l)}),options:Object.entries(v).map(([l,i])=>({value:l,label:i}))}),e.jsx(n,{label:t("common.category"),name:"field_category",type:"select",value:s.field_category,onChange:l=>o({...s,field_category:String(l)}),options:Object.entries(j).map(([l,i])=>({value:l,label:i}))})]}),s.field_type==="select"&&e.jsx(n,{label:t("settings.options")||"Opções",name:"field_options",value:s.field_options,onChange:l=>o({...s,field_options:String(l)}),helpText:"Separar opções por vírgula"}),e.jsx(n,{label:t("common.required")+" "+t("settings.byDefault"),name:"is_required_default",type:"checkbox",value:s.is_required_default,onChange:l=>o({...s,is_required_default:!!l})})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>x(!1),className:"px-4 py-2 text-gray-600 hover:text-gray-800 dark:text-gray-400",children:t("common.cancel")}),e.jsxs("button",{onClick:E,disabled:m||!s.field_name||!s.field_label_pt,className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:[m?e.jsx(N,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(C,{className:"h-4 w-4 mr-2"}),t("common.add")]})]})]})}),a&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:[t("common.edit"),": ",e.jsx("code",{className:"bg-gray-100 dark:bg-gray-700 px-2 rounded",children:a.field_name})]}),e.jsx("button",{onClick:()=>d(null),className:"text-gray-400 hover:text-gray-600",children:e.jsx(w,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(n,{label:"Label PT",name:"field_label_pt",value:a.field_label_pt,onChange:l=>d({...a,field_label_pt:String(l)}),required:!0}),e.jsx(n,{label:"Label EN",name:"field_label_en",value:a.field_label_en||"",onChange:l=>d({...a,field_label_en:String(l)})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(n,{label:"Label FR",name:"field_label_fr",value:a.field_label_fr||"",onChange:l=>d({...a,field_label_fr:String(l)})}),e.jsx(n,{label:"Label DE",name:"field_label_de",value:a.field_label_de||"",onChange:l=>d({...a,field_label_de:String(l)})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(n,{label:t("common.type"),name:"field_type",type:"select",value:a.field_type,onChange:l=>d({...a,field_type:String(l)}),options:Object.entries(v).map(([l,i])=>({value:l,label:i}))}),e.jsx(n,{label:t("common.category"),name:"field_category",type:"select",value:a.field_category,onChange:l=>d({...a,field_category:String(l)}),options:Object.entries(j).map(([l,i])=>({value:l,label:i}))})]}),e.jsx(n,{label:t("settings.order")||"Ordem",name:"field_order",type:"number",value:a.field_order,onChange:l=>d({...a,field_order:Number(l)})}),e.jsx(n,{label:t("common.required")+" "+(t("settings.byDefault")||"por defeito"),name:"is_required_default",type:"checkbox",value:a.is_required_default===1,onChange:l=>d({...a,is_required_default:l?1:0})})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>d(null),className:"px-4 py-2 text-gray-600 hover:text-gray-800 dark:text-gray-400",children:t("common.cancel")}),e.jsxs("button",{onClick:T,disabled:m,className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:[m?e.jsx(N,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(C,{className:"h-4 w-4 mr-2"}),t("common.save")]})]})]})}),e.jsx(X,{isOpen:h!==null,onClose:()=>y(null),onConfirm:()=>h&&I(h),title:t("settings.deleteField"),message:t("settings.deleteFieldConfirm"),confirmText:t("common.delete"),variant:"danger"})]})};export{Y as default};
