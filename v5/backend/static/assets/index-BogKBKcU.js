import{j as e}from"./vendor-ui-CHMJddlm.js";import{e as ye,f as H,u as K,r,j as fe,i as Ne}from"./vendor-react-B7WRoy5K.js";import{c as we,u as I,X as te,f as ke,a as j,e as ie,d as _e,F as P,i as Se,j as ae,k as Ce}from"./index-DtPl0Aq5.js";import{D as De}from"./DataTable-BLNIoykd.js";import{S as B}from"./StatusBadge-Duoy8DHc.js";import{F as y}from"./FormField-DYBwZHLt.js";import{C as W}from"./ConfirmDialog-CzgpSI6Z.js";import{F as Fe}from"./filter-BzVARH1i.js";import{R as Le}from"./rotate-ccw-d0tldefN.js";import{P as Te}from"./plus-DbJFhMt0.js";import{A as le}from"./arrow-left-BNF1B--8.js";import{L as A}from"./loader-2-Bagj4oM5.js";import{S as $e}from"./save-BUFuQ_vE.js";import{X as Ie}from"./x-circle-wNTTUt1a.js";import{C as X}from"./clock-BNBMV1Ah.js";import{U as q}from"./upload-TyijRZ5p.js";import{I as ne}from"./image-YcgQvB16.js";import{D as Ae}from"./download-BDjeYIb4.js";import{T as re}from"./trash-2-6_aEbyEp.js";import{C as Ee}from"./calendar-QtzoQi5S.js";import{P as Pe}from"./pen-DyExwM_J.js";import"./vendor-charts-C5vizwv2.js";import"./search-DRt6k5Fg.js";import"./chevron-up-ChLLO1Zs.js";import"./crosshair-V7IyEANw.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=we("FolderOpen",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);function Ue({filters:s,onReset:p,className:d=""}){const{t:l}=I(),n=s.some(i=>i.value!=="");return e.jsxs("div",{className:`bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm ${d}`,children:[e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Fe,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:l("common.filters")}),n&&e.jsxs("button",{onClick:p,className:"ml-auto flex items-center gap-1 text-xs text-gray-500 hover:text-gray-700 dark:hover:text-gray-300",children:[e.jsx(Le,{className:"h-3 w-3"}),l("common.reset")]})]}),e.jsx("div",{className:"flex flex-wrap gap-3",children:s.map(i=>e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:i.value,onChange:x=>i.onChange(x.target.value),className:`appearance-none pl-3 pr-8 py-2 text-sm border rounded-lg bg-white dark:bg-gray-700 transition-colors
                  ${i.value?"border-blue-500 text-blue-700 dark:text-blue-300 bg-blue-50 dark:bg-blue-900/30":"border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300"}
                  hover:border-blue-400 focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500`,children:[e.jsx("option",{value:"",children:i.label}),i.options.map(x=>e.jsx("option",{value:x.value,children:x.label},x.value))]}),i.value&&e.jsx("button",{onClick:()=>i.onChange(""),className:"absolute right-7 top-1/2 -translate-y-1/2 p-0.5 text-gray-400 hover:text-gray-600",children:e.jsx(te,{className:"h-3 w-3"})}),e.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-400",children:e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})})})]},i.name))})]}),n&&e.jsx("div",{className:"px-4 pb-3",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:s.filter(i=>i.value).map(i=>{const x=i.options.find(f=>f.value===i.value);return e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-blue-100 dark:bg-blue-900/40 text-blue-700 dark:text-blue-300 text-xs font-medium rounded-full",children:[i.label,": ",(x==null?void 0:x.label)||i.value,e.jsx("button",{onClick:()=>i.onChange(""),className:"p-0.5 hover:bg-blue-200 dark:hover:bg-blue-800 rounded-full",children:e.jsx(te,{className:"h-3 w-3"})})]},i.name)})})})]})}const oe=[{value:"documento",label:"documents",icon:P},{value:"foto_antes",label:"photosBefore",icon:ne},{value:"foto_depois",label:"photosAfter",icon:ne},{value:"relatorio",label:"reports",icon:Ce},{value:"outros",label:"others",icon:Be}],Me=()=>{const{t:s}=I(),{formatDate:p}=ke(),d=K(),[l,n]=r.useState([]),[i,x]=r.useState(null),[f,v]=r.useState(!0),[b,S]=r.useState(""),[u,w]=r.useState(""),[c,g]=r.useState(""),[C,N]=r.useState(1);r.useEffect(()=>{k()},[C,u,c]);const k=async()=>{v(!0);try{const o=new URLSearchParams({page:C.toString(),per_page:"20"});b&&o.append("asset",b),u&&o.append("status",u),c&&o.append("type",c);const L=await j.get(`/interventions?${o}`);n(L.data||[]),x(L.pagination)}catch(o){console.error("Error loading interventions:",o)}finally{v(!1)}},a=o=>{S(o),N(1),k()},m=[{key:"id",label:"ID",render:o=>`#${o}`},{key:"intervention_type",label:s("common.type"),render:o=>e.jsx(B,{status:o})},{key:"asset_serial",label:s("interventions.asset"),render:o=>o||"-"},{key:"status",label:s("common.status"),render:o=>e.jsx(B,{status:o})},{key:"created_at",label:s("common.createdAt"),render:o=>p(o)},{key:"created_by_name",label:s("interventions.assignedTo"),render:o=>o||"-"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:s("interventions.title")}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:[(i==null?void 0:i.total)||0," ",s("interventions.title").toLowerCase()]})]})}),e.jsx(Ue,{filters:[{name:"status",label:s("common.status"),value:u,onChange:o=>{w(o),N(1)},options:[{value:"em_curso",label:s("interventions.statuses.inProgress")},{value:"concluida",label:s("interventions.statuses.completed")},{value:"cancelada",label:s("interventions.statuses.cancelled")}]},{name:"type",label:s("common.type"),value:c,onChange:o=>{g(o),N(1)},options:[{value:"preventiva",label:s("interventions.types.preventive")},{value:"corretiva",label:s("interventions.types.corrective")},{value:"substituicao",label:s("interventions.types.installation")},{value:"inspecao",label:s("interventions.types.inspection")}]}],onReset:()=>{w(""),g(""),N(1)}}),e.jsx(De,{data:l,columns:m,loading:f,searchable:!0,searchValue:b,onSearchChange:a,searchPlaceholder:`${s("common.search")} ${s("interventions.asset").toLowerCase()}...`,onRowClick:o=>d(`/interventions/${o.id}`),emptyMessage:s("table.noResults"),pagination:i?{page:i.page,perPage:i.per_page,total:i.total,onPageChange:N}:void 0,actions:e.jsxs("button",{onClick:()=>d("/interventions/new"),className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700",children:[e.jsx(Te,{className:"h-5 w-5 mr-2"}),s("interventions.newIntervention")]})})]})},Oe=()=>{const{t:s}=I(),p=K(),d=ie(),[l]=fe(),n=l.get("asset")||"",[i,x]=r.useState(!1),[f,v]=r.useState(""),[b,S]=r.useState([]),[u,w]=r.useState([]),[c,g]=r.useState({asset_serial:n,intervention_type:"corretiva",problem_description:"",notes:"",technicians:[]});r.useEffect(()=>{C(),N()},[]);const C=async()=>{try{const a=await j.get("/assets?per_page=1000");S(a.data||[])}catch(a){console.error("Error loading assets:",a)}},N=async()=>{try{const a=await j.get("/users");w((a.users||a||[]).filter(m=>["operator","admin","superadmin"].includes(m.role)))}catch(a){console.error("Error loading technicians:",a)}},k=async a=>{a.preventDefault(),x(!0),v("");try{const m={...c,technicians:c.technicians.map(L=>({user_id:L,role:"participante"}))},o=await j.post("/interventions",m);d.success(s("interventions.interventionCreated")),setTimeout(()=>p(`/interventions/${o.id}`),1500)}catch(m){d.error(s("common.error"),m.message),v(m.message||s("common.error"))}finally{x(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>p(-1),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:e.jsx(le,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:s("interventions.newIntervention")})]}),f&&e.jsx("div",{className:"p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-700 dark:text-red-400 rounded-lg",children:f}),e.jsxs("form",{onSubmit:k,className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:s("interventions.interventionDetails")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(y,{label:s("interventions.asset"),name:"asset_serial",type:"select",value:c.asset_serial,onChange:a=>g({...c,asset_serial:String(a)}),options:b.map(a=>({value:a.serial_number,label:`${a.serial_number} - ${a.product_reference||""}`})),required:!0}),e.jsx(y,{label:s("interventions.interventionType"),name:"intervention_type",type:"select",value:c.intervention_type,onChange:a=>g({...c,intervention_type:String(a)}),options:[{value:"preventiva",label:s("interventions.types.preventive")},{value:"corretiva",label:s("interventions.types.corrective")},{value:"substituicao",label:s("interventions.types.installation")},{value:"inspecao",label:s("interventions.types.inspection")}],required:!0}),e.jsx(y,{label:s("interventions.problemDescription"),name:"problem_description",type:"textarea",value:c.problem_description,onChange:a=>g({...c,problem_description:String(a)}),className:"md:col-span-2"}),e.jsx(y,{label:s("common.notes"),name:"notes",type:"textarea",value:c.notes,onChange:a=>g({...c,notes:String(a)}),className:"md:col-span-2"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:s("interventions.technician")}),e.jsx("div",{className:"space-y-2",children:u.map(a=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:c.technicians.includes(a.id),onChange:m=>{m.target.checked?g({...c,technicians:[...c.technicians,a.id]}):g({...c,technicians:c.technicians.filter(o=>o!==a.id)})},className:"h-4 w-4 rounded border-gray-300"}),e.jsx("span",{children:a.first_name||a.email})]},a.id))})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{type:"button",onClick:()=>p(-1),className:"px-4 py-2 text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-lg",children:s("common.cancel")}),e.jsxs("button",{type:"submit",disabled:i,className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:[i?e.jsx(A,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx($e,{className:"h-4 w-4 mr-2"}),s("common.create")]})]})]})]})},Re=({log:s,onClose:p,onSave:d})=>{var c;const{t:l}=I(),[n,i]=r.useState(((c=s==null?void 0:s.time_spent)==null?void 0:c.toString())||""),[x,f]=r.useState((s==null?void 0:s.work_date)||""),[v,b]=r.useState((s==null?void 0:s.description)||""),[S,u]=r.useState(!1),w=async()=>{s&&(u(!0),await d(s.id,{time_spent:parseFloat(n),work_date:x,description:v}),u(!1),p())};return s?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:l("interventions.editTimeLog")}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(y,{label:l("interventions.hours"),name:"time_spent",type:"number",value:n,onChange:g=>i(String(g))}),e.jsx(y,{label:l("interventions.workDate"),name:"work_date",type:"date",value:x,onChange:g=>f(String(g))}),e.jsx(y,{label:l("common.description"),name:"description",type:"textarea",value:v,onChange:g=>b(String(g))})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[e.jsx("button",{onClick:p,className:"px-4 py-2 text-gray-600 dark:text-gray-400",children:l("common.cancel")}),e.jsx("button",{onClick:w,disabled:S,className:"px-4 py-2 bg-blue-600 text-white rounded-lg",children:S?e.jsx(A,{className:"h-4 w-4 animate-spin"}):l("common.save")})]})]})}):null},ze=({interventionId:s,onClose:p,onSuccess:d})=>{const{t:l}=I(),n=r.useRef(null),[i,x]=r.useState([]),[f,v]=r.useState("documento"),[b,S]=r.useState(""),[u,w]=r.useState(!1),[c,g]=r.useState(0),C=a=>{a.target.files&&x(Array.from(a.target.files))},N=async()=>{if(i.length===0)return;w(!0),g(0);const a=new FormData;i.forEach(m=>a.append("files",m)),a.append("category",f),a.append("description",b);try{await j.post(`/interventions/${s}/files/multiple`,a,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:m=>{m.total&&g(Math.round(m.loaded*100/m.total))}}),d(),p()}catch(m){console.error("Upload error:",m)}finally{w(!1)}},k=a=>a<1024?`${a} B`:a<1024*1024?`${(a/1024).toFixed(1)} KB`:`${(a/(1024*1024)).toFixed(2)} MB`;return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:l("interventions.uploadFiles")}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{onClick:()=>{var a;return(a=n.current)==null?void 0:a.click()},className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center cursor-pointer hover:border-blue-500 transition-colors",children:[e.jsx(q,{className:"h-10 w-10 mx-auto text-gray-400 mb-2"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:l("interventions.dropFilesHere")}),e.jsxs("p",{className:"text-sm text-gray-500",children:[l("interventions.maxFileSize"),": 3MB"]}),e.jsx("input",{ref:n,type:"file",multiple:!0,onChange:C,className:"hidden"})]}),i.length>0&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3",children:[e.jsxs("p",{className:"text-sm font-medium mb-2",children:[i.length," ",l("common.files"),":"]}),e.jsx("ul",{className:"space-y-1 text-sm max-h-32 overflow-y-auto",children:i.map((a,m)=>e.jsxs("li",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"truncate",children:a.name}),e.jsx("span",{className:"text-gray-500 ml-2",children:k(a.size)})]},m))})]}),e.jsx(y,{label:l("interventions.fileCategory"),name:"category",type:"select",value:f,onChange:a=>v(String(a)),options:oe.map(a=>({value:a.value,label:l(`interventions.fileCategories.${a.label}`)}))}),e.jsx(y,{label:l("common.description"),name:"description",type:"textarea",value:b,onChange:a=>S(String(a))}),u&&e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all",style:{width:`${c}%`}})})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[e.jsx("button",{onClick:p,disabled:u,className:"px-4 py-2 text-gray-600 dark:text-gray-400",children:l("common.cancel")}),e.jsx("button",{onClick:N,disabled:u||i.length===0,className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg disabled:opacity-50",children:u?e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"h-4 w-4 mr-2 animate-spin"}),c,"%"]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),l("common.upload")]})})]})]})})},He=()=>{const{t:s}=I(),p=K(),d=ie(),{interventionId:l}=Ne(),[n,i]=r.useState(null),[x,f]=r.useState(!0),[v,b]=r.useState(""),[S,u]=r.useState(!1),[w,c]=r.useState(!1),[g,C]=r.useState(!1),[N,k]=r.useState(!1),[a,m]=r.useState("Operacional"),[o,L]=r.useState(""),[$,V]=r.useState(""),[G,J]=r.useState(""),[Q,ce]=r.useState(new Date().toISOString().split("T")[0]),[Y,Z]=r.useState(null),[U,M]=r.useState(null),[O,R]=r.useState(null),[_,de]=r.useState(null),[z,me]=r.useState(null),[E,xe]=r.useState("details");r.useEffect(()=>{F()},[l]);const F=async()=>{try{const[t,h,T]=await Promise.all([j.get(`/interventions/${l}`),j.get(`/interventions/${l}/time`),j.get(`/interventions/${l}/files`)]);i(t),L(t.solution_description||""),de(h.statistics),me(T.statistics),t.time_logs=h.time_logs||t.time_logs,t.files=T.files||t.files,t.files_by_category=T.by_category,i({...t})}catch(t){b(t.message||s("common.error"))}finally{f(!1)}},ge=async()=>{k(!0);try{await j.post(`/interventions/${l}/complete`,{solution_description:o,final_asset_status:a}),d.success(s("interventions.interventionCompleted")),F(),u(!1)}catch(t){d.error(s("common.error"),t.message),b(t.message)}finally{k(!1)}},ue=async()=>{k(!0);try{await j.post(`/interventions/${l}/cancel`,{reason:"Cancelada pelo utilizador"}),d.warning(s("interventions.interventionCancelled")),F(),c(!1)}catch(t){d.error(s("common.error"),t.message),b(t.message)}finally{k(!1)}},he=async()=>{if(!(!$||parseFloat($)<=0))try{await j.post(`/interventions/${l}/time`,{time_spent:parseFloat($),work_date:Q,description:G}),d.success(s("interventions.timeLogged")),V(""),J(""),F()}catch(t){d.error(s("common.error"),t.message),b(t.message)}},pe=async(t,h)=>{try{await j.put(`/interventions/${l}/time/${t}`,h),d.success(s("interventions.timeLogUpdated")),F()}catch(T){d.error(s("common.error"),T.message)}},be=async()=>{if(U)try{await j.delete(`/interventions/${l}/time/${U}`),d.success(s("interventions.timeLogDeleted")),M(null),F()}catch(t){d.error(s("common.error"),t.message)}},ve=async()=>{if(O)try{await j.delete(`/interventions/${l}/files/${O}`),d.success(s("common.fileDeleted")),R(null),F()}catch(t){d.error(s("common.error"),t.message)}},je=t=>t<1024?`${t} B`:t<1024*1024?`${(t/1024).toFixed(1)} KB`:`${(t/(1024*1024)).toFixed(2)} MB`;if(x)return e.jsx("div",{className:"flex justify-center p-8",children:e.jsx(A,{className:"h-8 w-8 animate-spin"})});if(!n)return e.jsx("div",{className:"p-4 bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-400 rounded-lg",children:v||s("common.notFound")});const ee=(_==null?void 0:_.total_hours)||(n.time_logs||[]).reduce((t,h)=>t+h.time_spent,0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("button",{onClick:()=>p("/interventions"),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:e.jsx(le,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:[s("interventions.title")," #",n.id]}),e.jsxs("p",{className:"text-gray-500",children:[s("interventions.asset"),": ",n.asset_serial]}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx(B,{status:n.intervention_type}),e.jsx(B,{status:n.status})]})]})]}),n.status==="em_curso"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>u(!0),className:"inline-flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:[e.jsx(_e,{className:"h-4 w-4 mr-2"}),s("interventions.statuses.completed")]}),e.jsxs("button",{onClick:()=>c(!0),className:"inline-flex items-center px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:[e.jsx(Ie,{className:"h-4 w-4 mr-2"}),s("common.cancel")]})]})]}),v&&e.jsx("div",{className:"p-4 bg-red-50 text-red-700 rounded-lg",children:v}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-4 flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-blue-100 dark:bg-blue-900/30 rounded-lg",children:e.jsx(X,{className:"h-6 w-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:s("interventions.totalHours")}),e.jsxs("p",{className:"text-2xl font-bold",children:[ee.toFixed(1),"h"]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-4 flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-green-100 dark:bg-green-900/30 rounded-lg",children:e.jsx(P,{className:"h-6 w-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:s("common.files")}),e.jsx("p",{className:"text-2xl font-bold",children:(z==null?void 0:z.total_files)||0})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-4 flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-purple-100 dark:bg-purple-900/30 rounded-lg",children:e.jsx(Se,{className:"h-6 w-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:s("interventions.timeEntries")}),e.jsx("p",{className:"text-2xl font-bold",children:(_==null?void 0:_.total_entries)||0})]})]})]}),e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:e.jsx("nav",{className:"flex space-x-4",children:["details","files","time"].map(t=>e.jsx("button",{onClick:()=>xe(t),className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${E===t?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:s(`interventions.tabs.${t}`)},t))})}),E==="details"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:s("interventions.interventionDetails")}),e.jsxs("dl",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm text-gray-500",children:s("common.createdAt")}),e.jsx("dd",{className:"font-medium",children:new Date(n.created_at).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm text-gray-500",children:s("common.createdBy")}),e.jsx("dd",{className:"font-medium",children:n.created_by_name||n.created_by_email})]}),n.completed_at&&e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm text-gray-500",children:s("interventions.completedDate")}),e.jsx("dd",{className:"font-medium",children:new Date(n.completed_at).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm text-gray-500",children:s("interventions.laborHours")}),e.jsxs("dd",{className:"font-medium",children:[ee.toFixed(1)," h"]})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:s("common.description")}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:s("interventions.problemDescription")}),e.jsx("p",{className:"mt-1",children:n.problem_description||"-"})]}),n.solution_description&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:s("interventions.solutionDescription")}),e.jsx("p",{className:"mt-1",children:n.solution_description})]}),n.notes&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:s("common.notes")}),e.jsx("p",{className:"mt-1",children:n.notes})]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:s("technicians.title")}),(n.technicians||[]).length>0?e.jsx("ul",{className:"space-y-2",children:n.technicians.map((t,h)=>e.jsxs("li",{className:"flex items-center gap-2 text-sm",children:[e.jsx(ae,{className:"h-4 w-4 text-gray-400"}),t.user_name||t.user_email||t.external_name||s("interventions.technician"),t.external_company&&` (${t.external_company})`]},h))}):e.jsx("p",{className:"text-gray-500 text-sm",children:s("interventions.noTechniciansAssigned")})]}),(n.updates||[]).length>0&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:s("interventions.updates")}),e.jsx("ul",{className:"space-y-3",children:n.updates.slice(0,5).map(t=>e.jsxs("li",{className:"text-sm border-l-2 border-blue-500 pl-3",children:[e.jsx("p",{className:"font-medium",children:t.description}),e.jsx("p",{className:"text-gray-500 text-xs mt-1",children:new Date(t.created_at).toLocaleString()})]},t.id))})]})]})]}),E==="files"&&e.jsxs("div",{className:"space-y-6",children:[n.status==="em_curso"&&e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{onClick:()=>C(!0),className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),s("interventions.uploadFiles")]})}),oe.map(t=>{var se;const h=((se=n.files_by_category)==null?void 0:se[t.value])||[];if(h.length===0)return null;const T=t.icon;return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(T,{className:"h-5 w-5 text-gray-500"}),s(`interventions.fileCategories.${t.label}`),e.jsxs("span",{className:"text-sm font-normal text-gray-500",children:["(",h.length,")"]})]}),e.jsx("ul",{className:"space-y-2",children:h.map(D=>e.jsxs("li",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx(P,{className:"h-5 w-5 text-gray-400 flex-shrink-0"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:D.original_name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[je(D.file_size)," • ",new Date(D.uploaded_at).toLocaleDateString(),D.uploaded_by_name&&` • ${D.uploaded_by_name}`]}),D.description&&e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:D.description})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0 ml-4",children:[e.jsx("a",{href:`/api/interventions/${l}/files/${D.id}`,className:"p-2 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/30 rounded-lg",title:s("common.download"),children:e.jsx(Ae,{className:"h-4 w-4"})}),n.status==="em_curso"&&e.jsx("button",{onClick:()=>R(D.id),className:"p-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/30 rounded-lg",title:s("common.delete"),children:e.jsx(re,{className:"h-4 w-4"})})]})]},D.id))})]},t.value)}),(n.files||[]).length===0&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-8 text-center",children:[e.jsx(P,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-500",children:s("common.noFiles")}),n.status==="em_curso"&&e.jsx("button",{onClick:()=>C(!0),className:"mt-4 text-blue-600 hover:text-blue-700",children:s("interventions.uploadFirstFile")})]})]}),E==="time"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[n.status==="em_curso"&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:s("interventions.logTime")}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsx(y,{label:s("interventions.hours"),name:"time_spent",type:"number",value:$,onChange:t=>V(String(t))}),e.jsx(y,{label:s("interventions.workDate"),name:"work_date",type:"date",value:Q,onChange:t=>ce(String(t))}),e.jsx(y,{label:s("common.description"),name:"time_desc",type:"text",value:G,onChange:t=>J(String(t))})]}),e.jsx("div",{className:"mt-4",children:e.jsxs("button",{onClick:he,disabled:!$||parseFloat($)<=0,className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),s("interventions.register")]})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:s("interventions.timeLog")}),(n.time_logs||[]).length>0?e.jsx("ul",{className:"space-y-3",children:n.time_logs.map(t=>e.jsxs("li",{className:"flex items-start justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-lg font-semibold text-blue-600",children:[t.time_spent,"h"]}),e.jsxs("span",{className:"flex items-center gap-1 text-sm text-gray-500",children:[e.jsx(Ee,{className:"h-4 w-4"}),new Date(t.work_date).toLocaleDateString()]}),t.logged_by_name&&e.jsxs("span",{className:"flex items-center gap-1 text-sm text-gray-500",children:[e.jsx(ae,{className:"h-4 w-4"}),t.logged_by_name]})]}),t.description&&e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-2",children:t.description})]}),n.status==="em_curso"&&e.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[e.jsx("button",{onClick:()=>Z(t),className:"p-2 text-gray-500 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg",title:s("common.edit"),children:e.jsx(Pe,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>M(t.id),className:"p-2 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/30 rounded-lg",title:s("common.delete"),children:e.jsx(re,{className:"h-4 w-4"})})]})]},t.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(X,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-500",children:s("interventions.noTimeLogs")})]})]})]}),e.jsx("div",{className:"space-y-6",children:_&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:s("interventions.timeByUser")}),Object.keys(_.by_user||{}).length>0?e.jsx("ul",{className:"space-y-3",children:Object.entries(_.by_user).map(([t,h])=>e.jsxs("li",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm truncate",children:t}),e.jsxs("span",{className:"font-semibold text-blue-600",children:[h.toFixed(1),"h"]})]},t))}):e.jsx("p",{className:"text-gray-500 text-sm",children:s("interventions.noData")})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:s("interventions.timeByDate")}),Object.keys(_.by_date||{}).length>0?e.jsx("ul",{className:"space-y-3",children:Object.entries(_.by_date).slice(0,7).map(([t,h])=>e.jsxs("li",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:new Date(t).toLocaleDateString()}),e.jsxs("span",{className:"font-semibold text-blue-600",children:[h.toFixed(1),"h"]})]},t))}):e.jsx("p",{className:"text-gray-500 text-sm",children:s("interventions.noData")})]})]})})]}),S&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:s("interventions.completeIntervention")}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(y,{label:s("interventions.solutionDescription"),name:"solution",type:"textarea",value:o,onChange:t=>L(String(t))}),e.jsx(y,{label:s("interventions.finalAssetStatus"),name:"final_status",type:"select",value:a,onChange:t=>m(String(t)),options:["Operacional","Manutencao Necessaria","Desativado"]})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>u(!1),className:"px-4 py-2 text-gray-600 dark:text-gray-400",children:s("common.cancel")}),e.jsx("button",{onClick:ge,disabled:N,className:"px-4 py-2 bg-green-600 text-white rounded-lg",children:N?e.jsx(A,{className:"h-4 w-4 animate-spin"}):s("interventions.complete")})]})]})}),Y&&e.jsx(Re,{log:Y,onClose:()=>Z(null),onSave:pe}),g&&e.jsx(ze,{interventionId:l,onClose:()=>C(!1),onSuccess:F}),e.jsx(W,{isOpen:!!U,onClose:()=>M(null),onConfirm:be,title:s("interventions.deleteTimeLog"),message:s("interventions.deleteTimeLogConfirm"),confirmText:s("common.delete"),variant:"danger"}),e.jsx(W,{isOpen:!!O,onClose:()=>R(null),onConfirm:ve,title:s("common.deleteFile"),message:s("common.deleteFileConfirm"),confirmText:s("common.delete"),variant:"danger"}),e.jsx(W,{isOpen:w,onClose:()=>c(!1),onConfirm:ue,title:s("interventions.cancelIntervention"),message:s("interventions.cancelConfirmMessage"),confirmText:s("interventions.cancelIntervention"),variant:"danger",loading:N})]})},hs=()=>e.jsxs(ye,{children:[e.jsx(H,{index:!0,element:e.jsx(Me,{})}),e.jsx(H,{path:"new",element:e.jsx(Oe,{})}),e.jsx(H,{path:":interventionId",element:e.jsx(He,{})})]});export{hs as default};
