import{j as e}from"./vendor-ui-CHMJddlm.js";import{e as z,f as N,u as k,r as c,i as L}from"./vendor-react-B7WRoy5K.js";import{u as _}from"./useApi-u-xUQ-9Y.js";import{D as O}from"./DataTable-BLNIoykd.js";import{F as h}from"./FormField-DYBwZHLt.js";import{F as W}from"./FileUpload-BHW2Aw3s.js";import{S as y}from"./StatusBadge-Duoy8DHc.js";import{u as S,U as T,P as X,l as G,X as H}from"./index-DtPl0Aq5.js";import{C as P}from"./crown-C1KF_KsE.js";import{P as E}from"./pen-square-D2RmHv2H.js";import{S as $}from"./shield-yDWFBjZq.js";import{S as J}from"./settings-2-Du8VBWYu.js";import{P as K}from"./plus-DbJFhMt0.js";import{A as U}from"./arrow-left-BNF1B--8.js";import{S as Q}from"./save-BUFuQ_vE.js";import{I as V}from"./image-YcgQvB16.js";import"./search-DRt6k5Fg.js";import"./chevron-up-ChLLO1Zs.js";import"./crosshair-V7IyEANw.js";import"./upload-TyijRZ5p.js";import"./vendor-charts-C5vizwv2.js";function fe(){return e.jsxs(z,{children:[e.jsx(N,{index:!0,element:e.jsx(Y,{})}),e.jsx(N,{path:"new",element:e.jsx(F,{})}),e.jsx(N,{path:":id",element:e.jsx(Z,{})}),e.jsx(N,{path:":id/edit",element:e.jsx(F,{})})]})}function Y(){const m=k(),o=_(),{t:r}=S(),[a,i]=c.useState([]),[b,g]=c.useState(!0),[j,v]=c.useState({open:!1,tenant:null}),x=c.useCallback(async()=>{g(!0);try{const n=await o.get("/tenants");i(n||[])}catch(n){console.error("Error loading tenants:",n)}finally{g(!1)}},[o]);c.useEffect(()=>{x()},[x]);const u=async n=>{try{await o.put(`/tenants/${n.id}`,{active:!n.active}),x()}catch(l){alert(l.message||r("tenants.errorUpdatingTenant"))}},t=[{key:"name",label:r("common.name"),sortable:!0,render:(n,l)=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:`/api/tenants/${l.id}/logo?t=${Date.now()}`,alt:l.name,className:"w-10 h-10 object-contain rounded border border-gray-200",onError:p=>{p.target.src='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23ccc"><rect width="24" height="24"/></svg>'}}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:l.name}),l.is_master&&e.jsx(P,{className:"w-4 h-4 text-yellow-500",title:r("tenants.tenantMaster")})]}),e.jsx("span",{className:"text-sm text-gray-500",children:l.id})]})]})},{key:"plan",label:r("tenants.plan"),sortable:!0,render:(n,l)=>e.jsx(y,{status:l.plan,colorMap:{base:"gray",pro:"blue",premium:"purple",enterprise:"gold"}})},{key:"user_count",label:r("navigation.users"),sortable:!0,render:(n,l)=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(T,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{children:l.user_count})]})},{key:"asset_count",label:r("navigation.assets"),sortable:!0,render:(n,l)=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(X,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{children:l.asset_count})]})},{key:"active",label:r("common.status"),render:(n,l)=>e.jsx(y,{status:l.active?r("common.active"):r("common.inactive"),colorMap:{[r("common.active")]:"green",[r("common.inactive")]:"gray"}})},{key:"created_at",label:r("common.createdAt"),sortable:!0,render:(n,l)=>new Date(l.created_at).toLocaleDateString()},{key:"actions",label:r("common.actions"),render:(n,l)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:p=>{p.stopPropagation(),m(`/tenants/${l.id}/edit`)},className:"p-1 text-blue-600 hover:bg-blue-50 rounded",title:r("common.edit"),children:e.jsx(E,{className:"w-4 h-4"})}),!l.is_master&&e.jsx("button",{onClick:p=>{p.stopPropagation(),u(l)},className:`p-1 rounded ${l.active?"text-orange-600 hover:bg-orange-50":"text-green-600 hover:bg-green-50"}`,title:l.active?r("common.inactive"):r("common.active"),children:e.jsx($,{className:"w-4 h-4"})})]})}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:r("tenants.title")}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:r("tenants.subtitle")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>m("/plans"),className:"flex items-center gap-2 px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx(J,{className:"w-4 h-4"}),r("tenants.configurePlans")]}),e.jsxs("button",{onClick:()=>m("/tenants/new"),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[e.jsx(K,{className:"w-4 h-4"}),r("tenants.newTenant")]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900 rounded-lg",children:e.jsx(G,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:r("tenants.totalTenants")}),e.jsx("p",{className:"text-xl font-bold",children:a.length})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900 rounded-lg",children:e.jsx($,{className:"w-5 h-5 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:r("tenants.activeTenants")}),e.jsx("p",{className:"text-xl font-bold",children:a.filter(n=>n.active).length})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 dark:bg-purple-900 rounded-lg",children:e.jsx(T,{className:"w-5 h-5 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:r("tenants.totalUsers")}),e.jsx("p",{className:"text-xl font-bold",children:a.reduce((n,l)=>n+l.user_count,0)})]})]})})]}),e.jsx(O,{columns:t,data:a,loading:b,onRowClick:n=>m(`/tenants/${n.id}`),emptyMessage:r("tenants.noTenantFound")})]})}function F(){const m=k(),{id:o}=L(),r=_(),{t:a}=S(),i=!!o,[b,g]=c.useState(!1),[j,v]=c.useState(!1),[x,u]=c.useState(!1),[t,n]=c.useState({id:"",name:"",short_name:"",plan:"base",active:!0,admin_email:"",admin_password:""}),[l,p]=c.useState(null);c.useEffect(()=>{i&&A()},[o]);const A=async()=>{g(!0);try{const s=await r.get(`/tenants/${o}`);n({id:s.id||"",name:s.name||"",short_name:s.short_name||"",plan:s.plan||"base",active:s.active!==!1,admin_email:"",admin_password:""}),p(`/api/tenants/${o}/logo?t=${Date.now()}`)}catch(s){console.error("Error loading tenant:",s),m("/tenants")}finally{g(!1)}},M=async s=>{if(s.preventDefault(),!t.name.trim()){alert(a("tenants.nameRequired"));return}if(!i&&!t.id.trim()){alert(a("tenants.idRequired"));return}v(!0);try{i?await r.put(`/tenants/${o}`,{name:t.name,short_name:t.short_name,plan:t.plan,active:t.active}):await r.post("/tenants",{id:t.id.toLowerCase().replace(/\s+/g,"_"),name:t.name,short_name:t.short_name||t.name.substring(0,3).toUpperCase(),plan:t.plan,admin_email:t.admin_email||void 0,admin_password:t.admin_password||void 0}),m("/tenants")}catch(d){alert(d.message||a("tenants.errorSavingTenant"))}finally{v(!1)}},[q,D]=c.useState([]),B=async s=>{if(s.length===0||!i)return;const w=s[s.length-1].file;if(!w||!w.type.startsWith("image/")){alert(a("tenants.selectImage"));return}u(!0);try{const f=new FormData;f.append("file",w);const C=await fetch(`/api/tenants/${o}/logo`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`},body:f});if(!C.ok){const R=await C.json();throw new Error(R.error||a("tenants.errorSendingLogo"))}p(`/api/tenants/${o}/logo?t=${Date.now()}`),D([])}catch(f){alert(f.message||a("tenants.errorSendingLogo"))}finally{u(!1)}},I=s=>{D(s),s.length>0&&B(s)};return b?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>m("/tenants"),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg",children:e.jsx(U,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:a(i?"tenants.editTenant":"tenants.newTenant")}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:a(i?"tenants.alterTenantData":"tenants.createNewOrganization")})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("form",{onSubmit:M,className:"lg:col-span-2 bg-white dark:bg-gray-800 rounded-lg p-6 border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[!i&&e.jsx(h,{name:"id",label:a("tenants.uniqueIdentifier"),type:"text",value:t.id,onChange:s=>n(d=>({...d,id:s})),required:!0,placeholder:"ex: empresa_abc"}),e.jsx(h,{name:"name",label:a("common.name"),type:"text",value:t.name,onChange:s=>n(d=>({...d,name:s})),required:!0,placeholder:a("tenants.organizationName")}),e.jsx(h,{name:"short_name",label:a("tenants.shortName"),type:"text",value:t.short_name,onChange:s=>n(d=>({...d,short_name:s})),placeholder:"ABC"}),e.jsx(h,{name:"plan",label:a("tenants.plan"),type:"select",value:t.plan,onChange:s=>n(d=>({...d,plan:String(s)})),options:[{value:"base",label:a("tenants.plans.base")},{value:"pro",label:a("tenants.plans.pro")},{value:"premium",label:a("tenants.plans.premium")},{value:"enterprise",label:a("tenants.plans.enterprise")}]}),!i&&e.jsxs(e.Fragment,{children:[e.jsx(h,{name:"admin_email",label:a("tenants.adminEmail"),type:"text",value:t.admin_email,onChange:s=>n(d=>({...d,admin_email:s})),placeholder:"admin@empresa.com"}),e.jsx(h,{name:"admin_password",label:a("tenants.initialPassword"),type:"text",value:t.admin_password,onChange:s=>n(d=>({...d,admin_password:s})),placeholder:a("tenants.temporaryPassword")})]}),i&&e.jsx(h,{name:"active",label:a("common.active"),type:"checkbox",value:t.active,onChange:s=>n(d=>({...d,active:s}))})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6 pt-6 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("button",{type:"button",onClick:()=>m("/tenants"),className:"flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 dark:border-gray-600 dark:hover:bg-gray-700",children:[e.jsx(H,{className:"w-4 h-4"}),a("common.cancel")]}),e.jsxs("button",{type:"submit",disabled:j,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:[e.jsx(Q,{className:"w-4 h-4"}),a(j?"common.saving":"common.save")]})]})]}),i&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 border border-gray-200 dark:border-gray-700",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(V,{className:"w-5 h-5"}),a("tenants.logo")]}),l&&e.jsx("div",{className:"mb-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg flex items-center justify-center",children:e.jsx("img",{src:l,alt:"Logo preview",className:"max-h-32 object-contain",onError:s=>{s.target.style.display="none"}})}),e.jsx(W,{files:q,onFilesChange:I,accept:"image/png,image/jpeg,image/jpg",multiple:!1,maxFiles:1,label:a("tenants.uploadLogo")}),x&&e.jsx("div",{className:"mt-2 text-sm text-blue-600",children:a("tenants.sending")}),e.jsx("p",{className:"mt-2 text-xs text-gray-500",children:a("tenants.acceptedFormats")})]})]})]})}function Z(){const m=k(),{id:o}=L(),r=_(),{t:a}=S(),[i,b]=c.useState(null),[g,j]=c.useState([]),[v,x]=c.useState(!0);c.useEffect(()=>{u()},[o]);const u=async()=>{x(!0);try{const[t,n]=await Promise.all([r.get(`/tenants/${o}`),r.get(`/tenants/${o}/users`).catch(()=>[])]);b(t),j(n||[])}catch(t){console.error("Error loading tenant:",t),m("/tenants")}finally{x(!1)}};return v?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):i?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>m("/tenants"),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg",children:e.jsx(U,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:`/api/tenants/${i.id}/logo?t=${Date.now()}`,alt:i.name,className:"w-16 h-16 object-contain rounded border border-gray-200",onError:t=>{t.target.style.display="none"}}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:i.name}),i.is_master&&e.jsx(P,{className:"w-5 h-5 text-yellow-500"})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(y,{status:i.plan,colorMap:{base:"gray",pro:"blue",premium:"purple",enterprise:"gold"}}),e.jsx(y,{status:i.active?a("common.active"):a("common.inactive"),colorMap:{[a("common.active")]:"green",[a("common.inactive")]:"gray"}})]})]})]})]}),e.jsxs("button",{onClick:()=>m(`/tenants/${o}/edit`),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[e.jsx(E,{className:"w-4 h-4"}),a("common.edit")]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 border border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:a("tenants.information")}),e.jsxs("dl",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm text-gray-500 dark:text-gray-400",children:"ID"}),e.jsx("dd",{className:"font-mono",children:i.id})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm text-gray-500 dark:text-gray-400",children:a("tenants.shortName")}),e.jsx("dd",{children:i.short_name})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm text-gray-500 dark:text-gray-400",children:a("common.createdAt")}),e.jsx("dd",{children:new Date(i.created_at).toLocaleDateString()})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 border border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:a("tenants.statistics")}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:i.user_count}),e.jsx("p",{className:"text-sm text-gray-500",children:a("navigation.users")})]}),e.jsxs("div",{className:"text-center p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsx("p",{className:"text-3xl font-bold text-green-600",children:i.asset_count}),e.jsx("p",{className:"text-sm text-gray-500",children:a("navigation.assets")})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 border border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:a("navigation.users")}),g.length===0?e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:a("tenants.noUsers")}):e.jsxs("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:[g.slice(0,10).map(t=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 dark:bg-gray-700 rounded",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:t.email}),e.jsx("p",{className:"text-xs text-gray-500",children:t.role})]}),e.jsx(y,{status:t.active?a("common.active"):a("common.inactive"),colorMap:{[a("common.active")]:"green",[a("common.inactive")]:"gray"}})]},t.id)),g.length>10&&e.jsx("p",{className:"text-sm text-gray-500 text-center",children:a("tenants.moreUsers",{count:g.length-10})})]})]})]})]}):null}export{fe as default};
