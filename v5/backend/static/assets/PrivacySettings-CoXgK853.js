import{j as e}from"./vendor-ui-CHMJddlm.js";import{r as l}from"./vendor-react-B7WRoy5K.js";import{u as q,a as d,L as h,B as A,ar as z,ak as k,W as V,O as $,aN as M,C as b,y as U,S as G}from"./index-DJ2euB44.js";import"./vendor-charts-C5vizwv2.js";const H=()=>{const{t}=q(),[w,R]=l.useState(!0),[u,j]=l.useState(!1),[i,D]=l.useState(null),[S,E]=l.useState([]),[o,r]=l.useState(null),[C,m]=l.useState(!1),[x,p]=l.useState(""),[v,y]=l.useState(""),[f,N]=l.useState(!1);l.useEffect(()=>{g()},[]);const g=async()=>{try{const[a,s]=await Promise.all([d.get("/users/me/deletion-status"),d.get("/users/me/consents")]);D(a),E(s)}catch(a){console.error("Error loading privacy data:",a)}finally{R(!1)}},_=async()=>{j(!0),r(null);try{const a=await fetch("/api/users/me/data-export",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!a.ok)throw new Error("Erro ao exportar dados");const s=await a.blob(),n=window.URL.createObjectURL(s),c=document.createElement("a");c.href=n,c.download=`my_data_export_${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(c),c.click(),window.URL.revokeObjectURL(n),document.body.removeChild(c),r({type:"success",text:t("privacy.exportSuccess")})}catch(a){r({type:"error",text:a.message||t("errors.SERVER_ERROR")})}finally{j(!1)}},T=async()=>{if(!x){r({type:"error",text:t("privacy.passwordRequired")});return}N(!0),r(null);try{await d.post("/users/me/delete-request",{password:x,reason:v}),m(!1),p(""),y(""),await g(),r({type:"success",text:t("privacy.deletionRequested")})}catch(a){r({type:"error",text:a.message||t("errors.SERVER_ERROR")})}finally{N(!1)}},I=async()=>{try{await d.post("/users/me/cancel-deletion"),await g(),r({type:"success",text:t("privacy.deletionCancelled")})}catch(a){r({type:"error",text:a.message||t("errors.SERVER_ERROR")})}},P=async(a,s)=>{try{await d.post("/users/consent-log",{consent_type:a,granted:!s}),await g()}catch(n){r({type:"error",text:n.message||t("errors.SERVER_ERROR")})}},L=[{type:"marketing",label:t("privacy.consentMarketing"),description:t("privacy.consentMarketingDesc")},{type:"analytics",label:t("privacy.consentAnalytics"),description:t("privacy.consentAnalyticsDesc")},{type:"notifications",label:t("privacy.consentNotifications"),description:t("privacy.consentNotificationsDesc")}],O=a=>{const s=S.find(n=>n.consent_type===a);return(s==null?void 0:s.granted)||!1};return w?e.jsx("div",{className:"flex justify-center p-8",children:e.jsx(h,{size:"lg"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(A,{className:"h-6 w-6 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100",children:t("privacy.title")}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:t("privacy.description")})]})]}),o&&e.jsxs("div",{className:`p-4 rounded-lg flex items-center gap-3 ${o.type==="success"?"bg-green-50 text-green-800 dark:bg-green-900/20 dark:text-green-300":"bg-red-50 text-red-800 dark:bg-red-900/20 dark:text-red-300"}`,children:[o.type==="success"?e.jsx(z,{className:"h-5 w-5"}):e.jsx(k,{className:"h-5 w-5"}),o.text]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 bg-blue-100 dark:bg-blue-900/30 rounded-lg",children:e.jsx(V,{className:"h-6 w-6 text-blue-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:t("privacy.exportTitle")}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:t("privacy.exportDescription")}),e.jsxs("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-2",children:["RGPD Art. 20 - ",t("privacy.dataPortability")]}),e.jsxs("button",{onClick:_,disabled:u,className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 flex items-center gap-2",children:[u?e.jsx(h,{size:"sm"}):e.jsx($,{className:"h-4 w-4"}),t("privacy.downloadMyData")]})]})]})}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(M,{className:"h-5 w-5 text-green-600"}),e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:t("privacy.consentTitle")})]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-4",children:t("privacy.consentDescription")}),e.jsx("div",{className:"space-y-4",children:L.map(a=>{const s=O(a.type);return e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:a.label}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:a.description})]}),e.jsx("button",{onClick:()=>P(a.type,s),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${s?"bg-green-600":"bg-gray-300 dark:bg-gray-600"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${s?"translate-x-6":"translate-x-1"}`})})]},a.type)})})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-red-200 dark:border-red-900/50 p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 bg-red-100 dark:bg-red-900/30 rounded-lg",children:e.jsx(b,{className:"h-6 w-6 text-red-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:t("privacy.deleteTitle")}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:t("privacy.deleteDescription")}),e.jsxs("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-2",children:["RGPD Art. 17 - ",t("privacy.rightToErasure")]}),i!=null&&i.has_pending_request?e.jsxs("div",{className:"mt-4 p-4 bg-orange-50 dark:bg-orange-900/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-orange-800 dark:text-orange-300",children:[e.jsx(U,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:t("privacy.pendingDeletion")})]}),e.jsxs("p",{className:"text-sm text-orange-700 dark:text-orange-400 mt-2",children:[t("privacy.scheduledFor"),": ",new Date(i.scheduled_deletion_date).toLocaleDateString()]}),e.jsxs("button",{onClick:I,className:"mt-3 px-4 py-2 bg-white dark:bg-gray-700 text-orange-600 border border-orange-300 rounded-lg hover:bg-orange-50 flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4"}),t("privacy.cancelDeletion")]})]}):e.jsxs("button",{onClick:()=>m(!0),className:"mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 flex items-center gap-2",children:[e.jsx(b,{className:"h-4 w-4"}),t("privacy.requestDeletion")]})]})]})}),C&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl max-w-md w-full p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-red-100 dark:bg-red-900/30 rounded-full",children:e.jsx(k,{className:"h-6 w-6 text-red-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:t("privacy.confirmDeletion")})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:t("privacy.deletionWarning")}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[t("auth.password")," *"]}),e.jsx("input",{type:"password",value:x,onChange:a=>p(a.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",placeholder:t("privacy.enterPassword")})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[t("privacy.reason")," (",t("common.optional"),")"]}),e.jsx("textarea",{value:v,onChange:a=>y(a.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",rows:3,placeholder:t("privacy.reasonPlaceholder")})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>{m(!1),p(""),y("")},className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700",children:t("common.cancel")}),e.jsxs("button",{onClick:T,disabled:f||!x,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50 flex items-center justify-center gap-2",children:[f?e.jsx(h,{size:"sm"}):e.jsx(b,{className:"h-4 w-4"}),t("privacy.confirmDelete")]})]})]})})]})};export{H as default};
