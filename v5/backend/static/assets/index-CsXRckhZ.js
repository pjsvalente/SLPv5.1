import{j as e}from"./vendor-ui-CHMJddlm.js";import{e as F,f as k,u as C,r as d,i as U}from"./vendor-react-B7WRoy5K.js";import{k as E,u as D,m as T,a as p}from"./index-B4kLCiXA.js";import{D as $}from"./DataTable-BSposTC2.js";import{S as _}from"./StatusBadge-CibA2gJP.js";import{F as v}from"./FormField-DCiDuQxK.js";import{C as L}from"./ConfirmDialog-Nn_G2xOX.js";import{P as A}from"./plus-Cfzt9kvo.js";import{L as R}from"./loader-2-DC_6Rbqm.js";import{A as P}from"./arrow-left-_PODbINl.js";import{S as V}from"./save-DtwIG-4T.js";import{T as q}from"./trash-2-BUuoS4ap.js";import{S as I}from"./shield-DoAlDr2z.js";import"./vendor-charts-C5vizwv2.js";import"./search-DmVGYLxw.js";import"./chevron-up-BROWtztM.js";import"./chevron-left-wy1LzOob.js";import"./chevron-right-Cqn6hV-q.js";import"./map-pin-jrFkuuJh.js";import"./crosshair-CN5pgBQt.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=E("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=E("ShieldCheck",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=E("ShieldOff",[["path",{d:"M19.7 14a6.9 6.9 0 0 0 .3-2V5l-8-3-3.2 1.2",key:"342pvf"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M4.7 4.7 4 5v7c0 6 8 10 8 10a20.3 20.3 0 0 0 5.62-4.38",key:"p0ycf4"}]]),W=()=>{const{t:s}=D(),{formatDate:r}=T(),m=C(),[i,o]=d.useState([]),[N,y]=d.useState(!0),[b,j]=d.useState(""),[c,w]=d.useState("");d.useEffect(()=>{u()},[]);const u=async()=>{y(!0);try{const t=await p.get("/users");o(t.users||t||[])}catch(t){j(t.message||s("errors.SERVER_ERROR"))}finally{y(!1)}},n=i.filter(t=>{var f,a;const l=c.toLowerCase();return t.email.toLowerCase().includes(l)||(((f=t.first_name)==null?void 0:f.toLowerCase())||"").includes(l)||(((a=t.last_name)==null?void 0:a.toLowerCase())||"").includes(l)}),h=[{key:"email",label:s("users.email"),sortable:!0,render:(t,l)=>e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:t}),(l.first_name||l.last_name)&&e.jsxs("div",{className:"text-sm text-gray-500",children:[l.first_name," ",l.last_name]})]})},{key:"role",label:s("users.role"),render:t=>e.jsx(_,{status:t})},{key:"active",label:s("common.status"),render:t=>e.jsx(_,{status:t?"active":"inactive"})},{key:"two_factor_enabled",label:"2FA",render:t=>t?e.jsx(H,{className:"h-5 w-5 text-green-600"}):e.jsx(K,{className:"h-5 w-5 text-gray-400"})},{key:"last_login",label:s("users.lastLogin"),render:t=>t?r(t):s("common.none")}];return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:s("users.title")}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:[i.length," ",s("users.title").toLowerCase()]})]})}),b&&e.jsx("div",{className:"p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-700 dark:text-red-400 rounded-lg",children:b}),e.jsx($,{data:n,columns:h,loading:N,searchable:!0,searchValue:c,onSearchChange:w,searchPlaceholder:`${s("common.search")} ${s("users.email").toLowerCase()}...`,onRowClick:t=>m(`/users/${t.id}`),emptyMessage:s("table.noResults"),actions:e.jsxs("button",{onClick:()=>m("/users/new"),className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(A,{className:"h-5 w-5 mr-2"}),s("users.newUser")]})})]})},O=({mode:s})=>{const{t:r}=D(),m=C(),{userId:i}=U(),[o,N]=d.useState(s==="edit"),[y,b]=d.useState(!1),[j,c]=d.useState(""),[w,u]=d.useState(""),[n,h]=d.useState({email:"",first_name:"",last_name:"",phone:"",role:"user",password:"",confirm_password:""});d.useEffect(()=>{s==="edit"&&i&&t()},[s,i]);const t=async()=>{try{const a=await p.get(`/users/${i}`);h({email:a.email||"",first_name:a.first_name||"",last_name:a.last_name||"",phone:a.phone||"",role:a.role||"user",password:"",confirm_password:""})}catch(a){c(a.message||r("errors.SERVER_ERROR"))}finally{N(!1)}},l=(a,x)=>{h(S=>({...S,[a]:x})),c("")},f=async a=>{if(a.preventDefault(),s==="create"&&n.password!==n.confirm_password){c(r("errors.PASSWORDS_DONT_MATCH"));return}if(s==="create"&&n.password.length<8){c(r("errors.PASSWORD_TOO_SHORT"));return}b(!0),c("");try{const x={email:n.email,first_name:n.first_name,last_name:n.last_name,phone:n.phone,role:n.role};s==="create"?(x.password=n.password,await p.post("/users",x),u(r("users.userCreated"))):(await p.put(`/users/${i}`,x),u(r("users.userUpdated"))),setTimeout(()=>m("/users"),1500)}catch(x){c(x.message||r("errors.SERVER_ERROR"))}finally{b(!1)}};return o?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(R,{className:"h-8 w-8 animate-spin text-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>m(-1),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:e.jsx(P,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:r(s==="create"?"users.newUser":"users.editUser")})]}),j&&e.jsx("div",{className:"p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-700 dark:text-red-400 rounded-lg",children:j}),w&&e.jsx("div",{className:"p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 text-green-700 dark:text-green-400 rounded-lg",children:w}),e.jsxs("form",{onSubmit:f,className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:r("users.userDetails")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(v,{label:r("users.email"),name:"email",type:"email",value:n.email,onChange:a=>l("email",a),required:!0,disabled:s==="edit"}),e.jsx(v,{label:r("users.role"),name:"role",type:"select",value:n.role,onChange:a=>l("role",a),options:[{value:"user",label:r("users.roles.viewer")},{value:"operator",label:r("users.roles.technician")},{value:"admin",label:r("users.roles.admin")},{value:"superadmin",label:"Super Admin"}],required:!0}),e.jsx(v,{label:r("common.name"),name:"first_name",type:"text",value:n.first_name,onChange:a=>l("first_name",a)}),e.jsx(v,{label:r("technicians.fullName"),name:"last_name",type:"text",value:n.last_name,onChange:a=>l("last_name",a)}),e.jsx(v,{label:r("technicians.phone"),name:"phone",type:"text",value:n.phone,onChange:a=>l("phone",a)})]})]}),s==="create"&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:r("auth.password")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(v,{label:r("auth.password"),name:"password",type:"password",value:n.password,onChange:a=>l("password",a),required:!0}),e.jsx(v,{label:r("auth.confirmPassword"),name:"confirm_password",type:"password",value:n.confirm_password,onChange:a=>l("confirm_password",a),required:!0})]})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{type:"button",onClick:()=>m(-1),className:"px-4 py-2 text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600",children:r("common.cancel")}),e.jsx("button",{type:"submit",disabled:y,className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:y?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"h-4 w-4 mr-2 animate-spin"}),r("common.saving")]}):e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),r(s==="create"?"common.create":"common.save")]})})]})]})]})},z=()=>{const{t:s}=D(),{formatDate:r}=T(),m=C(),{userId:i}=U(),[o,N]=d.useState(null),[y,b]=d.useState(!0),[j,c]=d.useState(""),[w,u]=d.useState(!1),[n,h]=d.useState(!1),[t,l]=d.useState(!1);d.useEffect(()=>{f()},[i]);const f=async()=>{try{const g=await p.get(`/users/${i}`);N(g)}catch(g){c(g.message||s("errors.SERVER_ERROR"))}finally{b(!1)}},a=async()=>{l(!0);try{await p.delete(`/users/${i}`),m("/users")}catch(g){c(g.message||s("errors.SERVER_ERROR")),u(!1)}finally{l(!1)}},x=async()=>{l(!0);try{await p.post(`/users/${i}/reset-password`),h(!1),f()}catch(g){c(g.message||s("errors.SERVER_ERROR"))}finally{l(!1)}},S=async()=>{l(!0);try{await p.post(`/users/${i}/toggle-2fa`),f()}catch(g){c(g.message||s("errors.SERVER_ERROR"))}finally{l(!1)}};return y?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(R,{className:"h-8 w-8 animate-spin text-blue-600"})}):o?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("button",{onClick:()=>m("/users"),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:e.jsx(P,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:o.email}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400",children:[o.first_name," ",o.last_name]}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx(_,{status:o.role}),e.jsx(_,{status:o.active?"active":"inactive"})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>m(`/users/${i}/edit`),className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:s("common.edit")}),e.jsxs("button",{onClick:()=>u(!0),className:"inline-flex items-center px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),s("common.delete")]})]})]}),j&&e.jsx("div",{className:"p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-700 dark:text-red-400 rounded-lg",children:j}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:s("common.info")}),e.jsxs("dl",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm text-gray-500",children:s("users.email")}),e.jsx("dd",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:o.email})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm text-gray-500",children:s("common.name")}),e.jsxs("dd",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:[o.first_name," ",o.last_name]})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm text-gray-500",children:s("common.createdAt")}),e.jsx("dd",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:r(o.created_at)})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm text-gray-500",children:s("users.lastLogin")}),e.jsx("dd",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:o.last_login?r(o.last_login):s("common.none")})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:s("settings.security")}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(I,{className:"h-5 w-5 text-gray-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:s("users.twoFactorEnabled")}),e.jsx("p",{className:"text-sm text-gray-500",children:o.two_factor_enabled?s("common.active"):s("common.inactive")})]})]}),e.jsx("button",{onClick:S,disabled:t,className:`px-3 py-1.5 text-sm font-medium rounded-lg ${o.two_factor_enabled?"bg-red-100 text-red-700 hover:bg-red-200":"bg-green-100 text-green-700 hover:bg-green-200"}`,children:o.two_factor_enabled?s("common.inactive"):s("common.active")})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(M,{className:"h-5 w-5 text-gray-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:s("auth.resetPassword")}),e.jsx("p",{className:"text-sm text-gray-500",children:s("users.mustChangePassword")})]})]}),e.jsx("button",{onClick:()=>h(!0),className:"px-3 py-1.5 text-sm font-medium bg-yellow-100 text-yellow-700 hover:bg-yellow-200 rounded-lg",children:s("common.reset")})]})]})]})]}),e.jsx(L,{isOpen:w,onClose:()=>u(!1),onConfirm:a,title:s("common.delete"),message:s("confirmations.delete"),confirmText:s("common.delete"),variant:"danger",loading:t}),e.jsx(L,{isOpen:n,onClose:()=>h(!1),onConfirm:x,title:s("auth.resetPassword"),message:s("users.mustChangePassword"),confirmText:s("common.reset"),variant:"warning",loading:t})]}):e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 text-red-700 rounded-lg",children:s("errors.USER_NOT_FOUND")})},ge=()=>e.jsxs(F,{children:[e.jsx(k,{index:!0,element:e.jsx(W,{})}),e.jsx(k,{path:"new",element:e.jsx(O,{mode:"create"})}),e.jsx(k,{path:":userId",element:e.jsx(z,{})}),e.jsx(k,{path:":userId/edit",element:e.jsx(O,{mode:"edit"})})]});export{ge as default};
