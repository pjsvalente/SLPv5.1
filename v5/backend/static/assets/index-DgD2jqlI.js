import{j as e}from"./vendor-ui-CHMJddlm.js";import{e as ue,f as R,u as H,r,j as pe,i as be}from"./vendor-react-B7WRoy5K.js";import{u as $,Q as ve,R as je,S as Z,z as ye,a as j,e as fe,d as Ne,h as we,k as se,m as te,l as E,r as ke,O as _e,T as ee,U as Se,V as Ce,W as De}from"./index-BLvAk8YV.js";import{D as Fe}from"./DataTable-BZYckgkV.js";import{S as A}from"./StatusBadge-BUwToTGD.js";import{F as y}from"./FormField-CKODJuda.js";import{C as W}from"./ConfirmDialog-BY0bUzaR.js";import"./vendor-charts-C5vizwv2.js";function Te({filters:s,onReset:p,className:d=""}){const{t:l}=$(),n=s.some(i=>i.value!=="");return e.jsxs("div",{className:`bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm ${d}`,children:[e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(ve,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:l("common.filters")}),n&&e.jsxs("button",{onClick:p,className:"ml-auto flex items-center gap-1 text-xs text-gray-500 hover:text-gray-700 dark:hover:text-gray-300",children:[e.jsx(je,{className:"h-3 w-3"}),l("common.reset")]})]}),e.jsx("div",{className:"flex flex-wrap gap-3",children:s.map(i=>e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:i.value,onChange:x=>i.onChange(x.target.value),className:`appearance-none pl-3 pr-8 py-2 text-sm border rounded-lg bg-white dark:bg-gray-700 transition-colors
                  ${i.value?"border-blue-500 text-blue-700 dark:text-blue-300 bg-blue-50 dark:bg-blue-900/30":"border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300"}
                  hover:border-blue-400 focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500`,children:[e.jsx("option",{value:"",children:i.label}),i.options.map(x=>e.jsx("option",{value:x.value,children:x.label},x.value))]}),i.value&&e.jsx("button",{onClick:()=>i.onChange(""),className:"absolute right-7 top-1/2 -translate-y-1/2 p-0.5 text-gray-400 hover:text-gray-600",children:e.jsx(Z,{className:"h-3 w-3"})}),e.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-400",children:e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})})})]},i.name))})]}),n&&e.jsx("div",{className:"px-4 pb-3",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:s.filter(i=>i.value).map(i=>{const x=i.options.find(f=>f.value===i.value);return e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 bg-blue-100 dark:bg-blue-900/40 text-blue-700 dark:text-blue-300 text-xs font-medium rounded-full",children:[i.label,": ",(x==null?void 0:x.label)||i.value,e.jsx("button",{onClick:()=>i.onChange(""),className:"p-0.5 hover:bg-blue-200 dark:hover:bg-blue-800 rounded-full",children:e.jsx(Z,{className:"h-3 w-3"})})]},i.name)})})})]})}const ae=[{value:"documento",label:"documents",icon:_e},{value:"foto_antes",label:"photosBefore",icon:ee},{value:"foto_depois",label:"photosAfter",icon:ee},{value:"relatorio",label:"reports",icon:Se},{value:"outros",label:"others",icon:Ce}],Ie=()=>{const{t:s}=$(),{formatDate:p}=ye(),d=H(),[l,n]=r.useState([]),[i,x]=r.useState(null),[f,v]=r.useState(!0),[b,S]=r.useState(""),[h,w]=r.useState(""),[c,g]=r.useState(""),[C,N]=r.useState(1);r.useEffect(()=>{k()},[C,h,c]);const k=async()=>{v(!0);try{const o=new URLSearchParams({page:C.toString(),per_page:"20"});b&&o.append("asset",b),h&&o.append("status",h),c&&o.append("type",c);const T=await j.get(`/interventions?${o}`);n(T.data||[]),x(T.pagination)}catch(o){console.error("Error loading interventions:",o)}finally{v(!1)}},a=o=>{S(o),N(1),k()},m=[{key:"id",label:"ID",render:o=>`#${o}`},{key:"intervention_type",label:s("common.type"),render:o=>e.jsx(A,{status:o})},{key:"asset_serial",label:s("interventions.asset"),render:o=>o||"-"},{key:"status",label:s("common.status"),render:o=>e.jsx(A,{status:o})},{key:"created_at",label:s("common.createdAt"),render:o=>p(o)},{key:"created_by_name",label:s("interventions.assignedTo"),render:o=>o||"-"}];return e.jsxs(e.Fragment,{children:[e.jsx(fe,{}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-slp-navy dark:text-white flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-xl bg-gradient-to-br from-amber-400 to-orange-500",children:e.jsx(Ne,{size:24,className:"text-white"})}),s("interventions.title")]}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 mt-2",children:[(i==null?void 0:i.total)||0," ",s("interventions.title").toLowerCase()," ",s("common.registered").toLowerCase()]})]})}),e.jsx(Te,{filters:[{name:"status",label:s("common.status"),value:h,onChange:o=>{w(o),N(1)},options:[{value:"em_curso",label:s("interventions.statuses.inProgress")},{value:"concluida",label:s("interventions.statuses.completed")},{value:"cancelada",label:s("interventions.statuses.cancelled")}]},{name:"type",label:s("common.type"),value:c,onChange:o=>{g(o),N(1)},options:[{value:"preventiva",label:s("interventions.types.preventive")},{value:"corretiva",label:s("interventions.types.corrective")},{value:"substituicao",label:s("interventions.types.installation")},{value:"inspecao",label:s("interventions.types.inspection")}]}],onReset:()=>{w(""),g(""),N(1)}}),e.jsx(Fe,{data:l,columns:m,loading:f,searchable:!0,searchValue:b,onSearchChange:a,searchPlaceholder:`${s("common.search")} ${s("interventions.asset").toLowerCase()}...`,onRowClick:o=>d(`/interventions/${o.id}`),emptyMessage:s("table.noResults"),pagination:i?{page:i.page,perPage:i.per_page,total:i.total,onPageChange:N}:void 0,actions:e.jsxs("button",{onClick:()=>d("/interventions/new"),className:"group inline-flex items-center px-5 py-2.5 bg-gradient-to-r from-amber-400 to-orange-500 text-white font-semibold rounded-xl hover:shadow-lg hover:shadow-amber-500/30 transition-all duration-300",children:[e.jsx(we,{size:20,className:"mr-2 group-hover:scale-110 transition-transform"}),s("interventions.newIntervention")]})})]})]})},Le=()=>{const{t:s}=$(),p=H(),d=se(),[l]=pe(),n=l.get("asset")||"",[i,x]=r.useState(!1),[f,v]=r.useState(""),[b,S]=r.useState([]),[h,w]=r.useState([]),[c,g]=r.useState({asset_serial:n,intervention_type:"corretiva",problem_description:"",notes:"",technicians:[]});r.useEffect(()=>{C(),N()},[]);const C=async()=>{try{const a=await j.get("/assets?per_page=1000");S(a.data||[])}catch(a){console.error("Error loading assets:",a)}},N=async()=>{try{const a=await j.get("/users");w((a.users||a||[]).filter(m=>["operator","admin","superadmin"].includes(m.role)))}catch(a){console.error("Error loading technicians:",a)}},k=async a=>{a.preventDefault(),x(!0),v("");try{const m={...c,technicians:c.technicians.map(T=>({user_id:T,role:"participante"}))},o=await j.post("/interventions",m);d.success(s("interventions.interventionCreated")),setTimeout(()=>p(`/interventions/${o.id}`),1500)}catch(m){d.error(s("common.error"),m.message),v(m.message||s("common.error"))}finally{x(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>p(-1),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:e.jsx(te,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:s("interventions.newIntervention")})]}),f&&e.jsx("div",{className:"p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-700 dark:text-red-400 rounded-lg",children:f}),e.jsxs("form",{onSubmit:k,className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:s("interventions.interventionDetails")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(y,{label:s("interventions.asset"),name:"asset_serial",type:"select",value:c.asset_serial,onChange:a=>g({...c,asset_serial:String(a)}),options:b.map(a=>({value:a.serial_number,label:`${a.serial_number} - ${a.product_reference||""}`})),required:!0}),e.jsx(y,{label:s("interventions.interventionType"),name:"intervention_type",type:"select",value:c.intervention_type,onChange:a=>g({...c,intervention_type:String(a)}),options:[{value:"preventiva",label:s("interventions.types.preventive")},{value:"corretiva",label:s("interventions.types.corrective")},{value:"substituicao",label:s("interventions.types.installation")},{value:"inspecao",label:s("interventions.types.inspection")}],required:!0}),e.jsx(y,{label:s("interventions.problemDescription"),name:"problem_description",type:"textarea",value:c.problem_description,onChange:a=>g({...c,problem_description:String(a)}),className:"md:col-span-2"}),e.jsx(y,{label:s("common.notes"),name:"notes",type:"textarea",value:c.notes,onChange:a=>g({...c,notes:String(a)}),className:"md:col-span-2"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:s("interventions.technician")}),e.jsx("div",{className:"space-y-2",children:h.map(a=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:c.technicians.includes(a.id),onChange:m=>{m.target.checked?g({...c,technicians:[...c.technicians,a.id]}):g({...c,technicians:c.technicians.filter(o=>o!==a.id)})},className:"h-4 w-4 rounded border-gray-300"}),e.jsx("span",{children:a.first_name||a.email})]},a.id))})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{type:"button",onClick:()=>p(-1),className:"px-4 py-2 text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-lg",children:s("common.cancel")}),e.jsxs("button",{type:"submit",disabled:i,className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:[i?e.jsx(E,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(ke,{className:"h-4 w-4 mr-2"}),s("common.create")]})]})]})]})},$e=({log:s,onClose:p,onSave:d})=>{var c;const{t:l}=$(),[n,i]=r.useState(((c=s==null?void 0:s.time_spent)==null?void 0:c.toString())||""),[x,f]=r.useState((s==null?void 0:s.work_date)||""),[v,b]=r.useState((s==null?void 0:s.description)||""),[S,h]=r.useState(!1),w=async()=>{s&&(h(!0),await d(s.id,{time_spent:parseFloat(n),work_date:x,description:v}),h(!1),p())};return s?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 sm:p-6 w-full max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold mb-4",children:l("interventions.editTimeLog")}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(y,{label:l("interventions.hours"),name:"time_spent",type:"number",value:n,onChange:g=>i(String(g))}),e.jsx(y,{label:l("interventions.workDate"),name:"work_date",type:"date",value:x,onChange:g=>f(String(g))}),e.jsx(y,{label:l("common.description"),name:"description",type:"textarea",value:v,onChange:g=>b(String(g))})]}),e.jsxs("div",{className:"mt-6 flex flex-col-reverse sm:flex-row justify-end gap-2 sm:gap-3",children:[e.jsx("button",{onClick:p,className:"px-4 py-2 text-gray-600 dark:text-gray-400 text-sm sm:text-base",children:l("common.cancel")}),e.jsx("button",{onClick:w,disabled:S,className:"px-4 py-2 bg-blue-600 text-white rounded-lg text-sm sm:text-base",children:S?e.jsx(E,{className:"h-4 w-4 animate-spin"}):l("common.save")})]})]})}):null},Ee=({interventionId:s,onClose:p,onSuccess:d})=>{const{t:l}=$(),n=r.useRef(null),[i,x]=r.useState([]),[f,v]=r.useState("documento"),[b,S]=r.useState(""),[h,w]=r.useState(!1),[c,g]=r.useState(0),C=a=>{a.target.files&&x(Array.from(a.target.files))},N=async()=>{if(i.length===0)return;w(!0),g(0);const a=new FormData;i.forEach(m=>a.append("files",m)),a.append("category",f),a.append("description",b);try{await j.post(`/interventions/${s}/files/multiple`,a,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:m=>{m.total&&g(Math.round(m.loaded*100/m.total))}}),d(),p()}catch(m){console.error("Upload error:",m)}finally{w(!1)}},k=a=>a<1024?`${a} B`:a<1024*1024?`${(a/1024).toFixed(1)} KB`:`${(a/(1024*1024)).toFixed(2)} MB`;return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 sm:p-6 w-full max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold mb-4",children:l("interventions.uploadFiles")}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{onClick:()=>{var a;return(a=n.current)==null?void 0:a.click()},className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center cursor-pointer hover:border-blue-500 transition-colors",children:[e.jsx(Upload,{className:"h-10 w-10 mx-auto text-gray-400 mb-2"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:l("interventions.dropFilesHere")}),e.jsxs("p",{className:"text-sm text-gray-500",children:[l("interventions.maxFileSize"),": 3MB"]}),e.jsx("input",{ref:n,type:"file",multiple:!0,onChange:C,className:"hidden"})]}),i.length>0&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3",children:[e.jsxs("p",{className:"text-sm font-medium mb-2",children:[i.length," ",l("common.files"),":"]}),e.jsx("ul",{className:"space-y-1 text-sm max-h-32 overflow-y-auto",children:i.map((a,m)=>e.jsxs("li",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"truncate",children:a.name}),e.jsx("span",{className:"text-gray-500 ml-2",children:k(a.size)})]},m))})]}),e.jsx(y,{label:l("interventions.fileCategory"),name:"category",type:"select",value:f,onChange:a=>v(String(a)),options:ae.map(a=>({value:a.value,label:l(`interventions.fileCategories.${a.label}`)}))}),e.jsx(y,{label:l("common.description"),name:"description",type:"textarea",value:b,onChange:a=>S(String(a))}),h&&e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all",style:{width:`${c}%`}})})]}),e.jsxs("div",{className:"mt-6 flex flex-col-reverse sm:flex-row justify-end gap-2 sm:gap-3",children:[e.jsx("button",{onClick:p,disabled:h,className:"px-4 py-2 text-gray-600 dark:text-gray-400 text-sm sm:text-base",children:l("common.cancel")}),e.jsx("button",{onClick:N,disabled:h||i.length===0,className:"inline-flex items-center justify-center px-4 py-2 bg-blue-600 text-white rounded-lg disabled:opacity-50 text-sm sm:text-base",children:h?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"h-4 w-4 mr-2 animate-spin"}),c,"%"]}):e.jsxs(e.Fragment,{children:[e.jsx(Upload,{className:"h-4 w-4 mr-2"}),l("common.upload")]})})]})]})})},Ue=()=>{const{t:s}=$(),p=H(),d=se(),{interventionId:l}=be(),[n,i]=r.useState(null),[x,f]=r.useState(!0),[v,b]=r.useState(""),[S,h]=r.useState(!1),[w,c]=r.useState(!1),[g,C]=r.useState(!1),[N,k]=r.useState(!1),[a,m]=r.useState("Operacional"),[o,T]=r.useState(""),[L,q]=r.useState(""),[G,K]=r.useState(""),[V,ne]=r.useState(new Date().toISOString().split("T")[0]),[X,Q]=r.useState(null),[B,P]=r.useState(null),[z,M]=r.useState(null),[_,re]=r.useState(null),[O,ie]=r.useState(null),[U,le]=r.useState("details");r.useEffect(()=>{F()},[l]);const F=async()=>{try{const[t,u,I]=await Promise.all([j.get(`/interventions/${l}`),j.get(`/interventions/${l}/time`),j.get(`/interventions/${l}/files`)]);i(t),T(t.solution_description||""),re(u.statistics),ie(I.statistics),t.time_logs=u.time_logs||t.time_logs,t.files=I.files||t.files,t.files_by_category=I.by_category,i({...t})}catch(t){b(t.message||s("common.error"))}finally{f(!1)}},oe=async()=>{k(!0);try{await j.post(`/interventions/${l}/complete`,{solution_description:o,final_asset_status:a}),d.success(s("interventions.interventionCompleted")),F(),h(!1)}catch(t){d.error(s("common.error"),t.message),b(t.message)}finally{k(!1)}},ce=async()=>{k(!0);try{await j.post(`/interventions/${l}/cancel`,{reason:"Cancelada pelo utilizador"}),d.warning(s("interventions.interventionCancelled")),F(),c(!1)}catch(t){d.error(s("common.error"),t.message),b(t.message)}finally{k(!1)}},de=async()=>{if(!(!L||parseFloat(L)<=0))try{await j.post(`/interventions/${l}/time`,{time_spent:parseFloat(L),work_date:V,description:G}),d.success(s("interventions.timeLogged")),q(""),K(""),F()}catch(t){d.error(s("common.error"),t.message),b(t.message)}},me=async(t,u)=>{try{await j.put(`/interventions/${l}/time/${t}`,u),d.success(s("interventions.timeLogUpdated")),F()}catch(I){d.error(s("common.error"),I.message)}},xe=async()=>{if(B)try{await j.delete(`/interventions/${l}/time/${B}`),d.success(s("interventions.timeLogDeleted")),P(null),F()}catch(t){d.error(s("common.error"),t.message)}},ge=async()=>{if(z)try{await j.delete(`/interventions/${l}/files/${z}`),d.success(s("common.fileDeleted")),M(null),F()}catch(t){d.error(s("common.error"),t.message)}},he=t=>t<1024?`${t} B`:t<1024*1024?`${(t/1024).toFixed(1)} KB`:`${(t/(1024*1024)).toFixed(2)} MB`;if(x)return e.jsx("div",{className:"flex justify-center p-8",children:e.jsx(E,{className:"h-8 w-8 animate-spin"})});if(!n)return e.jsx("div",{className:"p-4 bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-400 rounded-lg",children:v||s("common.notFound")});const J=(_==null?void 0:_.total_hours)||(n.time_logs||[]).reduce((t,u)=>t+u.time_spent,0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("button",{onClick:()=>p("/interventions"),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:e.jsx(te,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:[s("interventions.title")," #",n.id]}),e.jsxs("p",{className:"text-gray-500",children:[s("interventions.asset"),": ",n.asset_serial]}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx(A,{status:n.intervention_type}),e.jsx(A,{status:n.status})]})]})]}),n.status==="em_curso"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>h(!0),className:"inline-flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:[e.jsx(CheckCircle,{className:"h-4 w-4 mr-2"}),s("interventions.statuses.completed")]}),e.jsxs("button",{onClick:()=>c(!0),className:"inline-flex items-center px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:[e.jsx(XCircle,{className:"h-4 w-4 mr-2"}),s("common.cancel")]})]})]}),v&&e.jsx("div",{className:"p-4 bg-red-50 text-red-700 rounded-lg",children:v}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-4 flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-blue-100 dark:bg-blue-900/30 rounded-lg",children:e.jsx(Clock,{className:"h-6 w-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:s("interventions.totalHours")}),e.jsxs("p",{className:"text-2xl font-bold",children:[J.toFixed(1),"h"]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-4 flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-green-100 dark:bg-green-900/30 rounded-lg",children:e.jsx(FileText,{className:"h-6 w-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:s("common.files")}),e.jsx("p",{className:"text-2xl font-bold",children:(O==null?void 0:O.total_files)||0})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-4 flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-purple-100 dark:bg-purple-900/30 rounded-lg",children:e.jsx(BarChart3,{className:"h-6 w-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:s("interventions.timeEntries")}),e.jsx("p",{className:"text-2xl font-bold",children:(_==null?void 0:_.total_entries)||0})]})]})]}),e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:e.jsx("nav",{className:"flex space-x-4",children:["details","files","time"].map(t=>e.jsx("button",{onClick:()=>le(t),className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${U===t?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:s(`interventions.tabs.${t}`)},t))})}),U==="details"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:s("interventions.interventionDetails")}),e.jsxs("dl",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm text-gray-500",children:s("common.createdAt")}),e.jsx("dd",{className:"font-medium",children:new Date(n.created_at).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm text-gray-500",children:s("common.createdBy")}),e.jsx("dd",{className:"font-medium",children:n.created_by_name||n.created_by_email})]}),n.completed_at&&e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm text-gray-500",children:s("interventions.completedDate")}),e.jsx("dd",{className:"font-medium",children:new Date(n.completed_at).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm text-gray-500",children:s("interventions.laborHours")}),e.jsxs("dd",{className:"font-medium",children:[J.toFixed(1)," h"]})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:s("common.description")}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:s("interventions.problemDescription")}),e.jsx("p",{className:"mt-1",children:n.problem_description||"-"})]}),n.solution_description&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:s("interventions.solutionDescription")}),e.jsx("p",{className:"mt-1",children:n.solution_description})]}),n.notes&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:s("common.notes")}),e.jsx("p",{className:"mt-1",children:n.notes})]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:s("technicians.title")}),(n.technicians||[]).length>0?e.jsx("ul",{className:"space-y-2",children:n.technicians.map((t,u)=>e.jsxs("li",{className:"flex items-center gap-2 text-sm",children:[e.jsx(User,{className:"h-4 w-4 text-gray-400"}),t.user_name||t.user_email||t.external_name||s("interventions.technician"),t.external_company&&` (${t.external_company})`]},u))}):e.jsx("p",{className:"text-gray-500 text-sm",children:s("interventions.noTechniciansAssigned")})]}),(n.updates||[]).length>0&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:s("interventions.updates")}),e.jsx("ul",{className:"space-y-3",children:n.updates.slice(0,5).map(t=>e.jsxs("li",{className:"text-sm border-l-2 border-blue-500 pl-3",children:[e.jsx("p",{className:"font-medium",children:t.description}),e.jsx("p",{className:"text-gray-500 text-xs mt-1",children:new Date(t.created_at).toLocaleString()})]},t.id))})]})]})]}),U==="files"&&e.jsxs("div",{className:"space-y-6",children:[n.status==="em_curso"&&e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{onClick:()=>C(!0),className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[e.jsx(Upload,{className:"h-4 w-4 mr-2"}),s("interventions.uploadFiles")]})}),ae.map(t=>{var Y;const u=((Y=n.files_by_category)==null?void 0:Y[t.value])||[];if(u.length===0)return null;const I=t.icon;return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(I,{className:"h-5 w-5 text-gray-500"}),s(`interventions.fileCategories.${t.label}`),e.jsxs("span",{className:"text-sm font-normal text-gray-500",children:["(",u.length,")"]})]}),e.jsx("ul",{className:"space-y-2",children:u.map(D=>e.jsxs("li",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx(FileText,{className:"h-5 w-5 text-gray-400 flex-shrink-0"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:D.original_name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[he(D.file_size)," • ",new Date(D.uploaded_at).toLocaleDateString(),D.uploaded_by_name&&` • ${D.uploaded_by_name}`]}),D.description&&e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:D.description})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0 ml-4",children:[e.jsx("a",{href:`/api/interventions/${l}/files/${D.id}`,className:"p-2 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/30 rounded-lg",title:s("common.download"),children:e.jsx(De,{className:"h-4 w-4"})}),n.status==="em_curso"&&e.jsx("button",{onClick:()=>M(D.id),className:"p-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/30 rounded-lg",title:s("common.delete"),children:e.jsx(Trash2,{className:"h-4 w-4"})})]})]},D.id))})]},t.value)}),(n.files||[]).length===0&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-8 text-center",children:[e.jsx(FileText,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-500",children:s("common.noFiles")}),n.status==="em_curso"&&e.jsx("button",{onClick:()=>C(!0),className:"mt-4 text-blue-600 hover:text-blue-700",children:s("interventions.uploadFirstFile")})]})]}),U==="time"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[n.status==="em_curso"&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:s("interventions.logTime")}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsx(y,{label:s("interventions.hours"),name:"time_spent",type:"number",value:L,onChange:t=>q(String(t))}),e.jsx(y,{label:s("interventions.workDate"),name:"work_date",type:"date",value:V,onChange:t=>ne(String(t))}),e.jsx(y,{label:s("common.description"),name:"time_desc",type:"text",value:G,onChange:t=>K(String(t))})]}),e.jsx("div",{className:"mt-4",children:e.jsxs("button",{onClick:de,disabled:!L||parseFloat(L)<=0,className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:[e.jsx(Clock,{className:"h-4 w-4 mr-2"}),s("interventions.register")]})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:s("interventions.timeLog")}),(n.time_logs||[]).length>0?e.jsx("ul",{className:"space-y-3",children:n.time_logs.map(t=>e.jsxs("li",{className:"flex items-start justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-lg font-semibold text-blue-600",children:[t.time_spent,"h"]}),e.jsxs("span",{className:"flex items-center gap-1 text-sm text-gray-500",children:[e.jsx(Calendar,{className:"h-4 w-4"}),new Date(t.work_date).toLocaleDateString()]}),t.logged_by_name&&e.jsxs("span",{className:"flex items-center gap-1 text-sm text-gray-500",children:[e.jsx(User,{className:"h-4 w-4"}),t.logged_by_name]})]}),t.description&&e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-2",children:t.description})]}),n.status==="em_curso"&&e.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[e.jsx("button",{onClick:()=>Q(t),className:"p-2 text-gray-500 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg",title:s("common.edit"),children:e.jsx(Edit2,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>P(t.id),className:"p-2 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/30 rounded-lg",title:s("common.delete"),children:e.jsx(Trash2,{className:"h-4 w-4"})})]})]},t.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Clock,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-500",children:s("interventions.noTimeLogs")})]})]})]}),e.jsx("div",{className:"space-y-6",children:_&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:s("interventions.timeByUser")}),Object.keys(_.by_user||{}).length>0?e.jsx("ul",{className:"space-y-3",children:Object.entries(_.by_user).map(([t,u])=>e.jsxs("li",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm truncate",children:t}),e.jsxs("span",{className:"font-semibold text-blue-600",children:[u.toFixed(1),"h"]})]},t))}):e.jsx("p",{className:"text-gray-500 text-sm",children:s("interventions.noData")})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:s("interventions.timeByDate")}),Object.keys(_.by_date||{}).length>0?e.jsx("ul",{className:"space-y-3",children:Object.entries(_.by_date).slice(0,7).map(([t,u])=>e.jsxs("li",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:new Date(t).toLocaleDateString()}),e.jsxs("span",{className:"font-semibold text-blue-600",children:[u.toFixed(1),"h"]})]},t))}):e.jsx("p",{className:"text-gray-500 text-sm",children:s("interventions.noData")})]})]})})]}),S&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 sm:p-6 w-full max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold mb-4",children:s("interventions.completeIntervention")}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(y,{label:s("interventions.solutionDescription"),name:"solution",type:"textarea",value:o,onChange:t=>T(String(t))}),e.jsx(y,{label:s("interventions.finalAssetStatus"),name:"final_status",type:"select",value:a,onChange:t=>m(String(t)),options:["Operacional","Manutencao Necessaria","Desativado"]})]}),e.jsxs("div",{className:"mt-6 flex flex-col-reverse sm:flex-row justify-end gap-2 sm:gap-3",children:[e.jsx("button",{onClick:()=>h(!1),className:"px-4 py-2 text-gray-600 dark:text-gray-400 text-sm sm:text-base",children:s("common.cancel")}),e.jsx("button",{onClick:oe,disabled:N,className:"px-4 py-2 bg-green-600 text-white rounded-lg text-sm sm:text-base",children:N?e.jsx(E,{className:"h-4 w-4 animate-spin"}):s("interventions.complete")})]})]})}),X&&e.jsx($e,{log:X,onClose:()=>Q(null),onSave:me}),g&&e.jsx(Ee,{interventionId:l,onClose:()=>C(!1),onSuccess:F}),e.jsx(W,{isOpen:!!B,onClose:()=>P(null),onConfirm:xe,title:s("interventions.deleteTimeLog"),message:s("interventions.deleteTimeLogConfirm"),confirmText:s("common.delete"),variant:"danger"}),e.jsx(W,{isOpen:!!z,onClose:()=>M(null),onConfirm:ge,title:s("common.deleteFile"),message:s("common.deleteFileConfirm"),confirmText:s("common.delete"),variant:"danger"}),e.jsx(W,{isOpen:w,onClose:()=>c(!1),onConfirm:ce,title:s("interventions.cancelIntervention"),message:s("interventions.cancelConfirmMessage"),confirmText:s("interventions.cancelIntervention"),variant:"danger",loading:N})]})},He=()=>e.jsxs(ue,{children:[e.jsx(R,{index:!0,element:e.jsx(Ie,{})}),e.jsx(R,{path:"new",element:e.jsx(Le,{})}),e.jsx(R,{path:":interventionId",element:e.jsx(Ue,{})})]});export{He as default};
