import{j as e}from"./vendor-ui-CHMJddlm.js";import{e as z,f as N,u as k,r as c,i as F}from"./vendor-react-B7WRoy5K.js";import{u as _}from"./useApi-DqL2_Wxn.js";import{D as O}from"./DataTable-BZYckgkV.js";import{F as p}from"./FormField-CKODJuda.js";import{u as S,al as L,c as T,I as W,t as E,B as $,n as X,h as G,a0 as H,m as P,S as J,r as K,T as Q}from"./index-BLvAk8YV.js";import{F as V}from"./FileUpload-D_bamF-q.js";import{S as y}from"./StatusBadge-BUwToTGD.js";import"./vendor-charts-C5vizwv2.js";function de(){return e.jsxs(z,{children:[e.jsx(N,{index:!0,element:e.jsx(Y,{})}),e.jsx(N,{path:"new",element:e.jsx(I,{})}),e.jsx(N,{path:":id",element:e.jsx(Z,{})}),e.jsx(N,{path:":id/edit",element:e.jsx(I,{})})]})}function Y(){const m=k(),o=_(),{t:n}=S(),[a,i]=c.useState([]),[b,g]=c.useState(!0),[j,v]=c.useState({open:!1,tenant:null}),x=c.useCallback(async()=>{g(!0);try{const r=await o.get("/tenants");i(r||[])}catch(r){console.error("Error loading tenants:",r)}finally{g(!1)}},[o]);c.useEffect(()=>{x()},[x]);const u=async r=>{try{await o.put(`/tenants/${r.id}`,{active:!r.active}),x()}catch(l){alert(l.message||n("tenants.errorUpdatingTenant"))}},t=[{key:"name",label:n("common.name"),sortable:!0,render:(r,l)=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:`/api/tenants/${l.id}/logo?t=${Date.now()}`,alt:l.name,className:"w-10 h-10 object-contain rounded border border-gray-200",onError:h=>{h.target.src='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23ccc"><rect width="24" height="24"/></svg>'}}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:l.name}),l.is_master&&e.jsx(L,{className:"w-4 h-4 text-yellow-500",title:n("tenants.tenantMaster")})]}),e.jsx("span",{className:"text-sm text-gray-500",children:l.id})]})]})},{key:"plan",label:n("tenants.plan"),sortable:!0,render:(r,l)=>e.jsx(y,{status:l.plan,colorMap:{base:"gray",pro:"blue",premium:"purple",enterprise:"gold"}})},{key:"user_count",label:n("navigation.users"),sortable:!0,render:(r,l)=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(T,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{children:l.user_count})]})},{key:"asset_count",label:n("navigation.assets"),sortable:!0,render:(r,l)=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(W,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{children:l.asset_count})]})},{key:"active",label:n("common.status"),render:(r,l)=>e.jsx(y,{status:l.active?n("common.active"):n("common.inactive"),colorMap:{[n("common.active")]:"green",[n("common.inactive")]:"gray"}})},{key:"created_at",label:n("common.createdAt"),sortable:!0,render:(r,l)=>new Date(l.created_at).toLocaleDateString()},{key:"actions",label:n("common.actions"),render:(r,l)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:h=>{h.stopPropagation(),m(`/tenants/${l.id}/edit`)},className:"p-1 text-blue-600 hover:bg-blue-50 rounded",title:n("common.edit"),children:e.jsx(E,{className:"w-4 h-4"})}),!l.is_master&&e.jsx("button",{onClick:h=>{h.stopPropagation(),u(l)},className:`p-1 rounded ${l.active?"text-orange-600 hover:bg-orange-50":"text-green-600 hover:bg-green-50"}`,title:l.active?n("common.inactive"):n("common.active"),children:e.jsx($,{className:"w-4 h-4"})})]})}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:n("tenants.title")}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:n("tenants.subtitle")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>m("/plans"),className:"flex items-center gap-2 px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx(X,{className:"w-4 h-4"}),n("tenants.configurePlans")]}),e.jsxs("button",{onClick:()=>m("/tenants/new"),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[e.jsx(G,{className:"w-4 h-4"}),n("tenants.newTenant")]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900 rounded-lg",children:e.jsx(H,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:n("tenants.totalTenants")}),e.jsx("p",{className:"text-xl font-bold",children:a.length})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900 rounded-lg",children:e.jsx($,{className:"w-5 h-5 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:n("tenants.activeTenants")}),e.jsx("p",{className:"text-xl font-bold",children:a.filter(r=>r.active).length})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 dark:bg-purple-900 rounded-lg",children:e.jsx(T,{className:"w-5 h-5 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:n("tenants.totalUsers")}),e.jsx("p",{className:"text-xl font-bold",children:a.reduce((r,l)=>r+l.user_count,0)})]})]})})]}),e.jsx(O,{columns:t,data:a,loading:b,onRowClick:r=>m(`/tenants/${r.id}`),emptyMessage:n("tenants.noTenantFound")})]})}function I(){const m=k(),{id:o}=F(),n=_(),{t:a}=S(),i=!!o,[b,g]=c.useState(!1),[j,v]=c.useState(!1),[x,u]=c.useState(!1),[t,r]=c.useState({id:"",name:"",short_name:"",plan:"base",active:!0,admin_email:"",admin_password:""}),[l,h]=c.useState(null);c.useEffect(()=>{i&&U()},[o]);const U=async()=>{g(!0);try{const s=await n.get(`/tenants/${o}`);r({id:s.id||"",name:s.name||"",short_name:s.short_name||"",plan:s.plan||"base",active:s.active!==!1,admin_email:"",admin_password:""}),h(`/api/tenants/${o}/logo?t=${Date.now()}`)}catch(s){console.error("Error loading tenant:",s),m("/tenants")}finally{g(!1)}},M=async s=>{if(s.preventDefault(),!t.name.trim()){alert(a("tenants.nameRequired"));return}if(!i&&!t.id.trim()){alert(a("tenants.idRequired"));return}v(!0);try{i?await n.put(`/tenants/${o}`,{name:t.name,short_name:t.short_name,plan:t.plan,active:t.active}):await n.post("/tenants",{id:t.id.toLowerCase().replace(/\s+/g,"_"),name:t.name,short_name:t.short_name||t.name.substring(0,3).toUpperCase(),plan:t.plan,admin_email:t.admin_email||void 0,admin_password:t.admin_password||void 0}),m("/tenants")}catch(d){alert(d.message||a("tenants.errorSavingTenant"))}finally{v(!1)}},[A,D]=c.useState([]),B=async s=>{if(s.length===0||!i)return;const w=s[s.length-1].file;if(!w||!w.type.startsWith("image/")){alert(a("tenants.selectImage"));return}u(!0);try{const f=new FormData;f.append("file",w);const C=await fetch(`/api/tenants/${o}/logo`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`},body:f});if(!C.ok){const q=await C.json();throw new Error(q.error||a("tenants.errorSendingLogo"))}h(`/api/tenants/${o}/logo?t=${Date.now()}`),D([])}catch(f){alert(f.message||a("tenants.errorSendingLogo"))}finally{u(!1)}},R=s=>{D(s),s.length>0&&B(s)};return b?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>m("/tenants"),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg",children:e.jsx(P,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:a(i?"tenants.editTenant":"tenants.newTenant")}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:a(i?"tenants.alterTenantData":"tenants.createNewOrganization")})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("form",{onSubmit:M,className:"lg:col-span-2 bg-white dark:bg-gray-800 rounded-lg p-6 border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[!i&&e.jsx(p,{name:"id",label:a("tenants.uniqueIdentifier"),type:"text",value:t.id,onChange:s=>r(d=>({...d,id:s})),required:!0,placeholder:"ex: empresa_abc"}),e.jsx(p,{name:"name",label:a("common.name"),type:"text",value:t.name,onChange:s=>r(d=>({...d,name:s})),required:!0,placeholder:a("tenants.organizationName")}),e.jsx(p,{name:"short_name",label:a("tenants.shortName"),type:"text",value:t.short_name,onChange:s=>r(d=>({...d,short_name:s})),placeholder:"ABC"}),e.jsx(p,{name:"plan",label:a("tenants.plan"),type:"select",value:t.plan,onChange:s=>r(d=>({...d,plan:String(s)})),options:[{value:"base",label:a("tenants.plans.base")},{value:"pro",label:a("tenants.plans.pro")},{value:"premium",label:a("tenants.plans.premium")},{value:"enterprise",label:a("tenants.plans.enterprise")}]}),!i&&e.jsxs(e.Fragment,{children:[e.jsx(p,{name:"admin_email",label:a("tenants.adminEmail"),type:"text",value:t.admin_email,onChange:s=>r(d=>({...d,admin_email:s})),placeholder:"admin@empresa.com"}),e.jsx(p,{name:"admin_password",label:a("tenants.initialPassword"),type:"text",value:t.admin_password,onChange:s=>r(d=>({...d,admin_password:s})),placeholder:a("tenants.temporaryPassword")})]}),i&&e.jsx(p,{name:"active",label:a("common.active"),type:"checkbox",value:t.active,onChange:s=>r(d=>({...d,active:s}))})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6 pt-6 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("button",{type:"button",onClick:()=>m("/tenants"),className:"flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 dark:border-gray-600 dark:hover:bg-gray-700",children:[e.jsx(J,{className:"w-4 h-4"}),a("common.cancel")]}),e.jsxs("button",{type:"submit",disabled:j,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:[e.jsx(K,{className:"w-4 h-4"}),a(j?"common.saving":"common.save")]})]})]}),i&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 border border-gray-200 dark:border-gray-700",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5"}),a("tenants.logo")]}),l&&e.jsx("div",{className:"mb-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg flex items-center justify-center",children:e.jsx("img",{src:l,alt:"Logo preview",className:"max-h-32 object-contain",onError:s=>{s.target.style.display="none"}})}),e.jsx(V,{files:A,onFilesChange:R,accept:"image/png,image/jpeg,image/jpg",multiple:!1,maxFiles:1,label:a("tenants.uploadLogo")}),x&&e.jsx("div",{className:"mt-2 text-sm text-blue-600",children:a("tenants.sending")}),e.jsx("p",{className:"mt-2 text-xs text-gray-500",children:a("tenants.acceptedFormats")})]})]})]})}function Z(){const m=k(),{id:o}=F(),n=_(),{t:a}=S(),[i,b]=c.useState(null),[g,j]=c.useState([]),[v,x]=c.useState(!0);c.useEffect(()=>{u()},[o]);const u=async()=>{x(!0);try{const[t,r]=await Promise.all([n.get(`/tenants/${o}`),n.get(`/tenants/${o}/users`).catch(()=>[])]);b(t),j(r||[])}catch(t){console.error("Error loading tenant:",t),m("/tenants")}finally{x(!1)}};return v?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):i?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>m("/tenants"),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg",children:e.jsx(P,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:`/api/tenants/${i.id}/logo?t=${Date.now()}`,alt:i.name,className:"w-16 h-16 object-contain rounded border border-gray-200",onError:t=>{t.target.style.display="none"}}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:i.name}),i.is_master&&e.jsx(L,{className:"w-5 h-5 text-yellow-500"})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(y,{status:i.plan,colorMap:{base:"gray",pro:"blue",premium:"purple",enterprise:"gold"}}),e.jsx(y,{status:i.active?a("common.active"):a("common.inactive"),colorMap:{[a("common.active")]:"green",[a("common.inactive")]:"gray"}})]})]})]})]}),e.jsxs("button",{onClick:()=>m(`/tenants/${o}/edit`),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[e.jsx(E,{className:"w-4 h-4"}),a("common.edit")]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 border border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:a("tenants.information")}),e.jsxs("dl",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm text-gray-500 dark:text-gray-400",children:"ID"}),e.jsx("dd",{className:"font-mono",children:i.id})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm text-gray-500 dark:text-gray-400",children:a("tenants.shortName")}),e.jsx("dd",{children:i.short_name})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm text-gray-500 dark:text-gray-400",children:a("common.createdAt")}),e.jsx("dd",{children:new Date(i.created_at).toLocaleDateString()})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 border border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:a("tenants.statistics")}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:i.user_count}),e.jsx("p",{className:"text-sm text-gray-500",children:a("navigation.users")})]}),e.jsxs("div",{className:"text-center p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsx("p",{className:"text-3xl font-bold text-green-600",children:i.asset_count}),e.jsx("p",{className:"text-sm text-gray-500",children:a("navigation.assets")})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 border border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:a("navigation.users")}),g.length===0?e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:a("tenants.noUsers")}):e.jsxs("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:[g.slice(0,10).map(t=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 dark:bg-gray-700 rounded",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:t.email}),e.jsx("p",{className:"text-xs text-gray-500",children:t.role})]}),e.jsx(y,{status:t.active?a("common.active"):a("common.inactive"),colorMap:{[a("common.active")]:"green",[a("common.inactive")]:"gray"}})]},t.id)),g.length>10&&e.jsx("p",{className:"text-sm text-gray-500 text-center",children:a("tenants.moreUsers",{count:g.length-10})})]})]})]})]}):null}export{de as default};
