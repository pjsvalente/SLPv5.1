import{j as e}from"./vendor-ui-CHMJddlm.js";import{r}from"./vendor-react-B7WRoy5K.js";import{u as $,a as m,t as z,C as F}from"./index-B4kLCiXA.js";import{C}from"./ConfirmDialog-Nn_G2xOX.js";import{L as d}from"./loader-2-DC_6Rbqm.js";import{P as O}from"./plus-Cfzt9kvo.js";import{H as D}from"./index-BL-5PVsj.js";import{C as _}from"./clock-DpJe5Urc.js";import{U as A}from"./user-DsvwqvEX.js";import{D as H}from"./download-DXjuMDGl.js";import{U as P}from"./upload-CWKF6k0o.js";import{T as G}from"./trash-2-BUuoS4ap.js";import"./vendor-charts-C5vizwv2.js";import"./FormField-DCiDuQxK.js";import"./map-pin-jrFkuuJh.js";import"./crosshair-CN5pgBQt.js";import"./database-Tk0afLsG.js";import"./shield-DoAlDr2z.js";import"./file-text-4hJVbqbZ.js";import"./settings-BtyuFtXW.js";import"./book-open-RPqfCM9j.js";import"./save-DtwIG-4T.js";const I=s=>{if(s===0)return"0 Bytes";const n=1024,x=["Bytes","KB","MB","GB"],i=Math.floor(Math.log(s)/Math.log(n));return parseFloat((s/Math.pow(n,i)).toFixed(2))+" "+x[i]},K=s=>{try{const n=new Date(s);return n.toLocaleDateString()+" "+n.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}catch{return s}},ge=()=>{const{t:s}=$(),[n,x]=r.useState([]),[i,S]=r.useState(30),[B,L]=r.useState(!0),[y,k]=r.useState(!1),[b,j]=r.useState(null),[w,N]=r.useState(null),[c,a]=r.useState(null),[p,g]=r.useState(null),[u,h]=r.useState(null);r.useEffect(()=>{f()},[]);const f=async()=>{try{const t=await m.get("/settings/backups");x(t.backups||[]),S(t.max_backups||30)}catch(t){a({type:"error",text:t.message})}finally{L(!1)}},R=async()=>{k(!0),a(null);try{const t=await m.post("/settings/backups");a({type:"success",text:s("backup.created")}),f()}catch(t){a({type:"error",text:t.message})}finally{k(!1)}},T=async t=>{try{const l=await fetch(`/api/settings/backups/${t}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!l.ok)throw new Error("Download failed");const E=await l.blob(),v=window.URL.createObjectURL(E),o=document.createElement("a");o.href=v,o.download=t,document.body.appendChild(o),o.click(),window.URL.revokeObjectURL(v),document.body.removeChild(o)}catch{a({type:"error",text:s("backup.downloadError")})}},U=async t=>{j(t),g(null),a(null);try{await m.post(`/settings/backups/${t}/restore`),a({type:"success",text:s("backup.restored")}),setTimeout(()=>{window.location.reload()},2e3)}catch(l){a({type:"error",text:l.message}),j(null)}},M=async t=>{N(t),h(null),a(null);try{await m.delete(`/settings/backups/${t}`),a({type:"success",text:s("backup.deleted")}),f()}catch(l){a({type:"error",text:l.message})}finally{N(null)}};return B?e.jsx("div",{className:"flex justify-center p-8",children:e.jsx(d,{className:"h-8 w-8 animate-spin text-gray-400"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:s("backup.description")}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-500 mt-1",children:[s("backup.limit",{max:i})," â€¢ ",n.length," ",s("backup.existing")]})]}),e.jsxs("button",{onClick:R,disabled:y,className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors",children:[y?e.jsx(d,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(O,{className:"h-4 w-4 mr-2"}),s("backup.create")]})]}),c&&e.jsxs("div",{className:`flex items-center gap-2 p-4 rounded-lg ${c.type==="error"?"bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-400":"bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-400"}`,children:[c.type==="error"?e.jsx(z,{className:"h-5 w-5 flex-shrink-0"}):e.jsx(F,{className:"h-5 w-5 flex-shrink-0"}),c.text]}),n.length===0?e.jsxs("div",{className:"text-center py-12 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx(D,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:s("backup.noBackups")}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 mt-1",children:s("backup.createFirst")})]}):e.jsx("div",{className:"space-y-3",children:n.map(t=>e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-5 w-5 text-gray-400 flex-shrink-0"}),e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100 truncate",children:t.filename})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-x-4 gap-y-1 mt-1 text-sm text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(_,{className:"h-3.5 w-3.5"}),K(t.created_at)]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(A,{className:"h-3.5 w-3.5"}),t.created_by]}),e.jsx("span",{children:I(t.size)}),t.version&&e.jsxs("span",{className:"text-xs bg-gray-200 dark:bg-gray-600 px-2 py-0.5 rounded",children:["v",t.version]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>T(t.filename),className:"p-2 text-gray-500 hover:text-blue-600 dark:text-gray-400 dark:hover:text-blue-400 transition-colors",title:s("backup.download"),children:e.jsx(H,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>g(t.filename),disabled:b===t.filename,className:"p-2 text-gray-500 hover:text-green-600 dark:text-gray-400 dark:hover:text-green-400 transition-colors disabled:opacity-50",title:s("backup.restore"),children:b===t.filename?e.jsx(d,{className:"h-5 w-5 animate-spin"}):e.jsx(P,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>h(t.filename),disabled:w===t.filename,className:"p-2 text-gray-500 hover:text-red-600 dark:text-gray-400 dark:hover:text-red-400 transition-colors disabled:opacity-50",title:s("backup.delete"),children:w===t.filename?e.jsx(d,{className:"h-5 w-5 animate-spin"}):e.jsx(G,{className:"h-5 w-5"})})]})]},t.filename))}),e.jsx(C,{isOpen:p!==null,onClose:()=>g(null),onConfirm:()=>p&&U(p),title:s("backup.restoreTitle"),message:s("backup.restoreConfirm"),confirmText:s("backup.restore"),variant:"warning"}),e.jsx(C,{isOpen:u!==null,onClose:()=>h(null),onConfirm:()=>u&&M(u),title:s("backup.deleteTitle"),message:s("backup.deleteConfirm"),confirmText:s("common.delete"),variant:"danger"})]})};export{ge as BackupSettings,ge as default};
