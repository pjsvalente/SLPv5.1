import{j as e}from"./vendor-ui-CHMJddlm.js";import{e as F,f as _,u as C,r as d,i as O}from"./vendor-react-B7WRoy5K.js";import{u as E,z as U,a as y,A as P,B as I,h as $,l as S,m as T,r as A,C as V,D as q}from"./index-Dn-ozWxe.js";import{D as B}from"./DataTable-D2OHuEfZ.js";import{S as k}from"./StatusBadge-o9yk1S5Z.js";import{F as w}from"./FormField-CgyOL_Jt.js";import{C as D}from"./ConfirmDialog-C6LMKA7_.js";import"./vendor-charts-C5vizwv2.js";const H=()=>{const{t:s}=E(),{formatDate:r}=U(),m=C(),[i,o]=d.useState([]),[N,b]=d.useState(!0),[p,j]=d.useState(""),[c,v]=d.useState("");d.useEffect(()=>{u()},[]);const u=async()=>{b(!0);try{const t=await y.get("/users");o(t.users||t||[])}catch(t){j(t.message||s("errors.SERVER_ERROR"))}finally{b(!1)}},n=i.filter(t=>{var f,a;const l=c.toLowerCase();return t.email.toLowerCase().includes(l)||(((f=t.first_name)==null?void 0:f.toLowerCase())||"").includes(l)||(((a=t.last_name)==null?void 0:a.toLowerCase())||"").includes(l)}),h=[{key:"email",label:s("users.email"),sortable:!0,render:(t,l)=>e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:t}),(l.first_name||l.last_name)&&e.jsxs("div",{className:"text-sm text-gray-500",children:[l.first_name," ",l.last_name]})]})},{key:"role",label:s("users.role"),render:t=>e.jsx(k,{status:t})},{key:"active",label:s("common.status"),render:t=>e.jsx(k,{status:t?"active":"inactive"})},{key:"two_factor_enabled",label:"2FA",render:t=>t?e.jsx(P,{className:"h-5 w-5 text-green-600"}):e.jsx(I,{className:"h-5 w-5 text-gray-400"})},{key:"last_login",label:s("users.lastLogin"),render:t=>t?r(t):s("common.none")}];return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:s("users.title")}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:[i.length," ",s("users.title").toLowerCase()]})]})}),p&&e.jsx("div",{className:"p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-700 dark:text-red-400 rounded-lg",children:p}),e.jsx(B,{data:n,columns:h,loading:N,searchable:!0,searchValue:c,onSearchChange:v,searchPlaceholder:`${s("common.search")} ${s("users.email").toLowerCase()}...`,onRowClick:t=>m(`/users/${t.id}`),emptyMessage:s("table.noResults"),actions:e.jsxs("button",{onClick:()=>m("/users/new"),className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx($,{className:"h-5 w-5 mr-2"}),s("users.newUser")]})})]})},L=({mode:s})=>{const{t:r}=E(),m=C(),{userId:i}=O(),[o,N]=d.useState(s==="edit"),[b,p]=d.useState(!1),[j,c]=d.useState(""),[v,u]=d.useState(""),[n,h]=d.useState({email:"",first_name:"",last_name:"",phone:"",role:"user",password:"",confirm_password:""});d.useEffect(()=>{s==="edit"&&i&&t()},[s,i]);const t=async()=>{try{const a=await y.get(`/users/${i}`);h({email:a.email||"",first_name:a.first_name||"",last_name:a.last_name||"",phone:a.phone||"",role:a.role||"user",password:"",confirm_password:""})}catch(a){c(a.message||r("errors.SERVER_ERROR"))}finally{N(!1)}},l=(a,x)=>{h(R=>({...R,[a]:x})),c("")},f=async a=>{if(a.preventDefault(),s==="create"&&n.password!==n.confirm_password){c(r("errors.PASSWORDS_DONT_MATCH"));return}if(s==="create"&&n.password.length<8){c(r("errors.PASSWORD_TOO_SHORT"));return}p(!0),c("");try{const x={email:n.email,first_name:n.first_name,last_name:n.last_name,phone:n.phone,role:n.role};s==="create"?(x.password=n.password,await y.post("/users",x),u(r("users.userCreated"))):(await y.put(`/users/${i}`,x),u(r("users.userUpdated"))),setTimeout(()=>m("/users"),1500)}catch(x){c(x.message||r("errors.SERVER_ERROR"))}finally{p(!1)}};return o?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(S,{className:"h-8 w-8 animate-spin text-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>m(-1),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:e.jsx(T,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:r(s==="create"?"users.newUser":"users.editUser")})]}),j&&e.jsx("div",{className:"p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-700 dark:text-red-400 rounded-lg",children:j}),v&&e.jsx("div",{className:"p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 text-green-700 dark:text-green-400 rounded-lg",children:v}),e.jsxs("form",{onSubmit:f,className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:r("users.userDetails")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(w,{label:r("users.email"),name:"email",type:"email",value:n.email,onChange:a=>l("email",a),required:!0,disabled:s==="edit"}),e.jsx(w,{label:r("users.role"),name:"role",type:"select",value:n.role,onChange:a=>l("role",a),options:[{value:"user",label:r("users.roles.viewer")},{value:"operator",label:r("users.roles.technician")},{value:"admin",label:r("users.roles.admin")},{value:"superadmin",label:"Super Admin"}],required:!0}),e.jsx(w,{label:r("common.name"),name:"first_name",type:"text",value:n.first_name,onChange:a=>l("first_name",a)}),e.jsx(w,{label:r("technicians.fullName"),name:"last_name",type:"text",value:n.last_name,onChange:a=>l("last_name",a)}),e.jsx(w,{label:r("technicians.phone"),name:"phone",type:"text",value:n.phone,onChange:a=>l("phone",a)})]})]}),s==="create"&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:r("auth.password")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(w,{label:r("auth.password"),name:"password",type:"password",value:n.password,onChange:a=>l("password",a),required:!0}),e.jsx(w,{label:r("auth.confirmPassword"),name:"confirm_password",type:"password",value:n.confirm_password,onChange:a=>l("confirm_password",a),required:!0})]})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{type:"button",onClick:()=>m(-1),className:"px-4 py-2 text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600",children:r("common.cancel")}),e.jsx("button",{type:"submit",disabled:b,className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:b?e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"h-4 w-4 mr-2 animate-spin"}),r("common.saving")]}):e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),r(s==="create"?"common.create":"common.save")]})})]})]})]})},M=()=>{const{t:s}=E(),{formatDate:r}=U(),m=C(),{userId:i}=O(),[o,N]=d.useState(null),[b,p]=d.useState(!0),[j,c]=d.useState(""),[v,u]=d.useState(!1),[n,h]=d.useState(!1),[t,l]=d.useState(!1);d.useEffect(()=>{f()},[i]);const f=async()=>{try{const g=await y.get(`/users/${i}`);N(g)}catch(g){c(g.message||s("errors.SERVER_ERROR"))}finally{p(!1)}},a=async()=>{l(!0);try{await y.delete(`/users/${i}`),m("/users")}catch(g){c(g.message||s("errors.SERVER_ERROR")),u(!1)}finally{l(!1)}},x=async()=>{l(!0);try{await y.post(`/users/${i}/reset-password`),h(!1),f()}catch(g){c(g.message||s("errors.SERVER_ERROR"))}finally{l(!1)}},R=async()=>{l(!0);try{await y.post(`/users/${i}/toggle-2fa`),f()}catch(g){c(g.message||s("errors.SERVER_ERROR"))}finally{l(!1)}};return b?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(S,{className:"h-8 w-8 animate-spin text-blue-600"})}):o?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("button",{onClick:()=>m("/users"),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:e.jsx(T,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:o.email}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400",children:[o.first_name," ",o.last_name]}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsx(k,{status:o.role}),e.jsx(k,{status:o.active?"active":"inactive"})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>m(`/users/${i}/edit`),className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:s("common.edit")}),e.jsxs("button",{onClick:()=>u(!0),className:"inline-flex items-center px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),s("common.delete")]})]})]}),j&&e.jsx("div",{className:"p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-700 dark:text-red-400 rounded-lg",children:j}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:s("common.info")}),e.jsxs("dl",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm text-gray-500",children:s("users.email")}),e.jsx("dd",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:o.email})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm text-gray-500",children:s("common.name")}),e.jsxs("dd",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:[o.first_name," ",o.last_name]})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm text-gray-500",children:s("common.createdAt")}),e.jsx("dd",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:r(o.created_at)})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-sm text-gray-500",children:s("users.lastLogin")}),e.jsx("dd",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:o.last_login?r(o.last_login):s("common.none")})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:s("settings.security")}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(I,{className:"h-5 w-5 text-gray-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:s("users.twoFactorEnabled")}),e.jsx("p",{className:"text-sm text-gray-500",children:o.two_factor_enabled?s("common.active"):s("common.inactive")})]})]}),e.jsx("button",{onClick:R,disabled:t,className:`px-3 py-1.5 text-sm font-medium rounded-lg ${o.two_factor_enabled?"bg-red-100 text-red-700 hover:bg-red-200":"bg-green-100 text-green-700 hover:bg-green-200"}`,children:o.two_factor_enabled?s("common.inactive"):s("common.active")})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(q,{className:"h-5 w-5 text-gray-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:s("auth.resetPassword")}),e.jsx("p",{className:"text-sm text-gray-500",children:s("users.mustChangePassword")})]})]}),e.jsx("button",{onClick:()=>h(!0),className:"px-3 py-1.5 text-sm font-medium bg-yellow-100 text-yellow-700 hover:bg-yellow-200 rounded-lg",children:s("common.reset")})]})]})]})]}),e.jsx(D,{isOpen:v,onClose:()=>u(!1),onConfirm:a,title:s("common.delete"),message:s("confirmations.delete"),confirmText:s("common.delete"),variant:"danger",loading:t}),e.jsx(D,{isOpen:n,onClose:()=>h(!1),onConfirm:x,title:s("auth.resetPassword"),message:s("users.mustChangePassword"),confirmText:s("common.reset"),variant:"warning",loading:t})]}):e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 text-red-700 rounded-lg",children:s("errors.USER_NOT_FOUND")})},Z=()=>e.jsxs(F,{children:[e.jsx(_,{index:!0,element:e.jsx(H,{})}),e.jsx(_,{path:"new",element:e.jsx(L,{mode:"create"})}),e.jsx(_,{path:":userId",element:e.jsx(M,{})}),e.jsx(_,{path:":userId/edit",element:e.jsx(L,{mode:"edit"})})]});export{Z as default};
